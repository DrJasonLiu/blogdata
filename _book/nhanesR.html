<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="LiuLinhu">
<meta name="dcterms.date" content="2022-10-05">
<meta name="description" content="A Tutorial for nhanesR Packages to Manipulate Data in NHANES">

<title>Data science of JasonLiu - 5&nbsp; nhanesR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./孟德尔随机化.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>
    .quarto-title-block .quarto-title-banner {
      color: #FFDDFF;
    }
    </style>


</head>

<body class="nav-sidebar docked nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./Rlogo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Data science of JasonLiu</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./R语言编程-基于tidyverse.html" aria-current="page">R语言</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Python.html">Python</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./NHANES.html">My notes</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-title">nhanesR</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title d-none d-lg-block"><span class="chapter-title">nhanesR</span></h1>
                  <div>
        <div class="description">
          A Tutorial for nhanesR Packages to Manipulate Data in NHANES
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>LiuLinhu </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 5, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R语言编程-基于tidyverse.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">R语言编程-基于tidyverse</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R机器学习.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">R 机器学习</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R数据可视化.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">R数据可视化</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./孟德尔随机化.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">孟德尔随机化</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nhanesR.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">nhanesR</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#安装配置nhanesr" id="toc-安装配置nhanesr" class="nav-link active" data-scroll-target="#安装配置nhanesr">安装配置nhanesR</a></li>
  <li><a href="#数据读取" id="toc-数据读取" class="nav-link" data-scroll-target="#数据读取">数据读取</a></li>
  <li><a href="#权重" id="toc-权重" class="nav-link" data-scroll-target="#权重">权重</a>
  <ul>
  <li><a href="#如何计算合并权重" id="toc-如何计算合并权重" class="nav-link" data-scroll-target="#如何计算合并权重">如何计算合并权重</a></li>
  <li><a href="#示例实操" id="toc-示例实操" class="nav-link" data-scroll-target="#示例实操">示例实操</a>
  <ul class="collapse">
  <li><a href="#示例1" id="toc-示例1" class="nav-link" data-scroll-target="#示例1">示例1</a></li>
  </ul></li>
  <li><a href="#权重总结" id="toc-权重总结" class="nav-link" data-scroll-target="#权重总结">权重总结</a></li>
  </ul></li>
  <li><a href="#数据的清洗" id="toc-数据的清洗" class="nav-link" data-scroll-target="#数据的清洗">数据的清洗</a>
  <ul>
  <li><a href="#数据的合并" id="toc-数据的合并" class="nav-link" data-scroll-target="#数据的合并">数据的合并</a></li>
  <li><a href="#添加新列" id="toc-添加新列" class="nav-link" data-scroll-target="#添加新列">添加新列</a></li>
  </ul></li>
  <li><a href="#数据提取汇总" id="toc-数据提取汇总" class="nav-link" data-scroll-target="#数据提取汇总">数据提取汇总</a>
  <ul>
  <li><a href="#提取人口学数据" id="toc-提取人口学数据" class="nav-link" data-scroll-target="#提取人口学数据">提取人口学数据</a></li>
  <li><a href="#提取饮食数据" id="toc-提取饮食数据" class="nav-link" data-scroll-target="#提取饮食数据">提取饮食数据</a></li>
  <li><a href="#提取生存数据" id="toc-提取生存数据" class="nav-link" data-scroll-target="#提取生存数据">提取生存数据</a></li>
  <li><a href="#提取饮酒相关数据" id="toc-提取饮酒相关数据" class="nav-link" data-scroll-target="#提取饮酒相关数据">提取饮酒相关数据</a></li>
  <li><a href="#黄酮类化合物数据提取" id="toc-黄酮类化合物数据提取" class="nav-link" data-scroll-target="#黄酮类化合物数据提取">黄酮类化合物数据提取</a></li>
  <li><a href="#重金属数据提取" id="toc-重金属数据提取" class="nav-link" data-scroll-target="#重金属数据提取">重金属数据提取</a></li>
  <li><a href="#药物搜索与提取" id="toc-药物搜索与提取" class="nav-link" data-scroll-target="#药物搜索与提取">药物搜索与提取</a></li>
  </ul></li>
  <li><a href="#指标计算汇总" id="toc-指标计算汇总" class="nav-link" data-scroll-target="#指标计算汇总">指标计算汇总</a>
  <ul>
  <li><a href="#健康饮食指数healthy-eating-index" id="toc-健康饮食指数healthy-eating-index" class="nav-link" data-scroll-target="#健康饮食指数healthy-eating-index">健康饮食指数（Healthy eating index）</a></li>
  <li><a href="#咖啡数据提取" id="toc-咖啡数据提取" class="nav-link" data-scroll-target="#咖啡数据提取">咖啡数据提取</a></li>
  <li><a href="#饮食炎症指数的提取" id="toc-饮食炎症指数的提取" class="nav-link" data-scroll-target="#饮食炎症指数的提取">饮食炎症指数的提取</a></li>
  <li><a href="#肾小球滤过率egfr" id="toc-肾小球滤过率egfr" class="nav-link" data-scroll-target="#肾小球滤过率egfr">肾小球滤过率eGFR</a></li>
  <li><a href="#益生元益生菌合生元" id="toc-益生元益生菌合生元" class="nav-link" data-scroll-target="#益生元益生菌合生元">益生元、益生菌、合生元</a></li>
  </ul></li>
  <li><a href="#疾病诊断汇总" id="toc-疾病诊断汇总" class="nav-link" data-scroll-target="#疾病诊断汇总">疾病诊断汇总</a>
  <ul>
  <li><a href="#代谢综合征" id="toc-代谢综合征" class="nav-link" data-scroll-target="#代谢综合征">代谢综合征</a></li>
  <li><a href="#高血压" id="toc-高血压" class="nav-link" data-scroll-target="#高血压">高血压</a></li>
  <li><a href="#高脂血症" id="toc-高脂血症" class="nav-link" data-scroll-target="#高脂血症">高脂血症</a></li>
  <li><a href="#糖尿病" id="toc-糖尿病" class="nav-link" data-scroll-target="#糖尿病">糖尿病</a></li>
  <li><a href="#吸烟" id="toc-吸烟" class="nav-link" data-scroll-target="#吸烟">吸烟</a></li>
  <li><a href="#抑郁" id="toc-抑郁" class="nav-link" data-scroll-target="#抑郁">抑郁</a></li>
  <li><a href="#ckd" id="toc-ckd" class="nav-link" data-scroll-target="#ckd">CKD</a></li>
  <li><a href="#mafld代谢功能障碍相关脂肪性肝病" id="toc-mafld代谢功能障碍相关脂肪性肝病" class="nav-link" data-scroll-target="#mafld代谢功能障碍相关脂肪性肝病">MAFLD代谢功能障碍相关脂肪性肝病</a></li>
  </ul></li>
  <li><a href="#fped数据库" id="toc-fped数据库" class="nav-link" data-scroll-target="#fped数据库">FPED数据库</a>
  <ul>
  <li><a href="#fruit" id="toc-fruit" class="nav-link" data-scroll-target="#fruit">Fruit</a></li>
  <li><a href="#vegetables" id="toc-vegetables" class="nav-link" data-scroll-target="#vegetables">Vegetables</a></li>
  <li><a href="#grains" id="toc-grains" class="nav-link" data-scroll-target="#grains">Grains</a></li>
  <li><a href="#dairy" id="toc-dairy" class="nav-link" data-scroll-target="#dairy">Dairy</a></li>
  <li><a href="#protein-foods" id="toc-protein-foods" class="nav-link" data-scroll-target="#protein-foods">Protein foods</a></li>
  <li><a href="#others" id="toc-others" class="nav-link" data-scroll-target="#others">Others</a></li>
  </ul></li>
  <li><a href="#易侕" id="toc-易侕" class="nav-link" data-scroll-target="#易侕">易侕</a></li>
  <li><a href="#文献复现" id="toc-文献复现" class="nav-link" data-scroll-target="#文献复现">文献复现</a>
  <ul>
  <li><a href="#中性粒细胞减少的流行病学" id="toc-中性粒细胞减少的流行病学" class="nav-link" data-scroll-target="#中性粒细胞减少的流行病学">1. 中性粒细胞减少的流行病学</a>
  <ul class="collapse">
  <li><a href="#提取数据" id="toc-提取数据" class="nav-link" data-scroll-target="#提取数据">提取数据</a></li>
  <li><a href="#复杂抽样的加权" id="toc-复杂抽样的加权" class="nav-link" data-scroll-target="#复杂抽样的加权">复杂抽样的加权</a></li>
  <li><a href="#总人口和缺失人群分析" id="toc-总人口和缺失人群分析" class="nav-link" data-scroll-target="#总人口和缺失人群分析">总人口和缺失人群分析</a></li>
  <li><a href="#线性回归比较不同种族细胞计数的变化校正年龄性别" id="toc-线性回归比较不同种族细胞计数的变化校正年龄性别" class="nav-link" data-scroll-target="#线性回归比较不同种族细胞计数的变化校正年龄性别">线性回归比较不同种族细胞计数的变化：校正年龄、性别</a></li>
  <li><a href="#table1mean-hematologic-values-by-age-sex-and-ethnic-group" id="toc-table1mean-hematologic-values-by-age-sex-and-ethnic-group" class="nav-link" data-scroll-target="#table1mean-hematologic-values-by-age-sex-and-ethnic-group">Table1：Mean Hematologic Values, by Age, Sex, and Ethnic Group</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#检索表" id="toc-检索表" class="nav-link" data-scroll-target="#检索表">检索表</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<section id="安装配置nhanesr" class="level2">
<h2 class="anchored" data-anchor-id="安装配置nhanesr">安装配置nhanesR</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(devtools)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(nhanesR)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'yikeshu0611/nhshelp'</span>,<span class="at">force=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> nhshelp<span class="sc">::</span><span class="fu">install_nhanesR</span>(<span class="st">'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'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">config_path</span>(<span class="st">"/Users/liulinhu/Desktop/NHANES/2022-08-01/NHANES"</span>)<span class="co">#配置数据库路径</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">config_years</span>()<span class="co">#配置数据库年份</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">config_items</span>()<span class="co">#配置数据库文件类型</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">bu</span>( x,<span class="st">'( 1, 2]'</span>)<span class="co">#指(1,2], 即x大于1，≤2</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">bu</span>( x,<span class="st">'[ , ]'</span>)<span class="co">#指大于等于，小于等于</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>fped数据是<strong>Food Patterns Equivalents Database，</strong>codebook文件里是全部变量的变量和解释；varLabel是标签的解释。</p>
</section>
<section id="数据读取" class="level2">
<h2 class="anchored" data-anchor-id="数据读取">数据读取</h2>
<ol type="1">
<li>知道变量名以及所在的文件: 例如age的变量名是ridageyr，所在的文件是demo_b，demo_c等。</li>
<li>从文件中提取变量</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(nhanesR)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nhs_tsv</span>(<span class="st">'demo'</span>,<span class="at">years =</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2016</span>)<span class="co">#选择2015-2016年的包含demo的数据（demographic）</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nhs_tsv</span>(<span class="st">"demo</span><span class="sc">\\</span><span class="st">."</span>,<span class="st">'!~p'</span>,<span class="at">years =</span> <span class="dv">1999</span>)<span class="co">#1999年，包含"demo."但不包含"p"的数据</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(nhanesR)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> tsv <span class="ot">&lt;-</span> <span class="fu">nhs_tsv</span>(<span class="st">"demo"</span>)<span class="co">#提取所有人口学数据</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nhs_brief</span>(tsv,<span class="st">"age"</span>) <span class="sc">|&gt;</span> <span class="fu">View</span>() <span class="co">#查找tsv中包含age的所有，从而确定年龄变量名为ridageyr</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">nhs_read</span>(tsv,<span class="st">"ridageyr:age"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               <span class="st">"riagendr:gender-u"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               <span class="st">"dmqmilit:mili"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               <span class="st">"dmqmiliz:mili"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               <span class="at">codebook =</span> T,)<span class="co">#:后面可以重命名变量;codebook参数表示是否解码变量的含义;如果对某个变量不想解码就在最后加-u;varLebel会给变量加上解释(不建议添加，会改变对象格式)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">nhs_brief</span>(tsv,<span class="st">"mili"</span>)<span class="co">#查找参军相关的变量，发现在后面的年份出现了新的变量名dmqmilit和dmqmiliz，其实是一样的,都改为mili变量。该函数运行完后会直接复制变量名到粘贴板，直接在nhs_read中粘贴就可以了</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>强化nhs_tsv()函数对数据的提取</li>
</ol>
<p>在R中，.表示任意一个字符，\.则表示单纯的.这个字符。|表示”或者”的逻辑关系, !~表示不包含</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nhs_tsv</span>(<span class="st">'lab10'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nhs_tsv</span>(<span class="st">"lab10</span><span class="sc">\\</span><span class="st">."</span>)<span class="co">#只提取lab10.这个文件</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">nhs_tsv</span>(<span class="st">"lab13am|l13am|trigly"</span>)<span class="co">#提取这三个文件</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nhs_tsv</span>(<span class="st">"lab13am|l13am|trigly"</span>,<span class="st">"!~l13am_b|l13am_c"</span>)<span class="co">#提取三个文件，但不包含l13am_b和l13am_c</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li><p>实验室检查数据的读取<br>
先去网站上检索，如hemoglobin，然后确定文件名. nhs_read支持连续添加数据，只需要先输入文件名再输入变量，如(cbc, “lbxhgb’, demo,” riagendr”), 如果不指定变量，会把cbc中所有的变量全部提取进去</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(nhanesR)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> demo <span class="ot">&lt;-</span> <span class="fu">nhs_tsv</span>(<span class="st">"demo"</span>)<span class="co">#提取所有人口学数据</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> cbc <span class="ot">&lt;-</span> <span class="fu">nhs_tsv</span>(<span class="st">"lab25|l25|cbc"</span>)<span class="co">#血红蛋白有三个不同的文件名，全部提取</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> bmx <span class="ot">&lt;-</span> <span class="fu">nhs_tsv</span>(<span class="st">"bmx"</span>)<span class="co">#提取bmi和腰围所在的文件</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">nhs_read</span>(demo,<span class="st">"ridageyr:age"</span>,<span class="st">"riagendr:gender"</span>,<span class="st">"dmqmilit:mili"</span>,<span class="st">"dmqmiliz:mili"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               cbc,<span class="st">"lbxhgb:Hbg"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               bmx,<span class="st">"bmxbmi:BMI"</span>,<span class="st">"bmxwaist:Waist"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               <span class="at">codebook =</span> T)<span class="co">#直接将血红蛋白和BMI和腰围的数据添加到之前人口学数据之后</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> nit1 <span class="ot">&lt;-</span> <span class="fu">head</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
<div class="cell">

</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/20221003094800.png" class="img-fluid" width="428"></p>
</section>
<section id="权重" class="level2">
<h2 class="anchored" data-anchor-id="权重">权重</h2>
<p>1.找到合理的权重。2.计算合并权重；权重不需要计算，nhanes已经计算好了，只需要计算<u><strong>合并权重</strong></u>。</p>
<p>NHANES中提供了各种各样的权重，如interview权重(wtint2yr), mec测试权重(wtmec2yr)和一些亚组的权重。一个好的经验法则是使用”最小公分母”，其中针对<u><strong>最少数量的访谈者收集的感兴趣变量</strong></u>是”最小公分母”。适用于该变量的样本权重是用于该特定分析的适当权重。所有访谈和mec测试权重都可以在相应调查周期的人口统计文件中找到。注意：有些问卷组件是在mec会话期间而非家庭访谈期间管理的，因此必须对这些组件使用mec测试权重</p>
<section id="如何计算合并权重" class="level3">
<h3 class="anchored" data-anchor-id="如何计算合并权重">如何计算合并权重</h3>
<p>wtint2yr指两年的（一个year circle）权重，选择了几个year circle就乘以几分之1。及合并权重=对应权重*1/n。但当<u><strong>同时涉及</strong>到1999-2000和2001-2002</u>时需要用4年权重<strong>wtint4yr</strong>，分开使用只需要2年权重。如果涉及1999-2002和其他year circle，如2003-2004，此时6年的权重wt6yr=2/3×wt4yr，和1/3×wt2yr。如果是8年权重wt8yr=2/4×wt4yr和1/4×wt2yr，如此类推<img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202209281102323.png" class="img-fluid" width="458"></p>
</section>
<section id="示例实操" class="level3">
<h3 class="anchored" data-anchor-id="示例实操">示例实操</h3>
<section id="示例1" class="level4">
<h4 class="anchored" data-anchor-id="示例1">示例1</h4>
<p>nhanes2013-2016，种族西班牙裔血统以及贫困与20岁及以上成年人<u><strong>先前诊断</strong></u>为糖尿病的关联。所有的变量都是在家庭访谈中收集的。使用访谈权重进行分析wtint4yr,查询到种族的变量名为ridreth1，贫困poverty的变量名为indfmpir，年龄变量名为ridageyr；糖尿病的诊断在Questionnaire里的diq010变量。权重提取<u>wtint2yr</u></p>
</section>
</section>
<section id="权重总结" class="level3">
<h3 class="anchored" data-anchor-id="权重总结">权重总结</h3>
<ul>
<li><p>家庭采访权重interview（范围最大）；wtint2yr/wtint4yr</p></li>
<li><p>车里的权重MEC（mobile examination car）（范围较int小）；wtmec2yr/wtmec4yr</p></li>
<li><p>其他权重（范围最小）；wtsaf2yr等，范围最小</p>
<p>选择权重应该选择最小权重，即不同权重的交集（即有特殊权重就选特殊权重，没有就选mec或int</p></li>
<li><p>合并权重的计算：year circle为n，合并权重为1/n*2yr; 如果同时出现1999-2000和2001-2002，这两个circle的合并权重为2/n×4yr，其余的circle还是1/n×2yr</p></li>
</ul>
</section>
</section>
<section id="数据的清洗" class="level2">
<h2 class="anchored" data-anchor-id="数据的清洗">数据的清洗</h2>
<ul>
<li><p><u><strong>如何快速输入Factor</strong></u></p>
<p>基于nhanesR包里的Factor函数，可以直接生成factor化的代码</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"white"</span>,<span class="st">"black"</span>,<span class="st">"red"</span>,<span class="st">"purple"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">Factor</span>(c)<span class="co">#运行这行便会自动生成下一行的因子化的代码</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> c <span class="ot">&lt;-</span> <span class="fu">factor</span>(c, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"white"</span>,<span class="st">"black"</span>,<span class="st">"red"</span>,<span class="st">"purple"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><u><strong>如何修改变量名（Recode）</strong></u></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> c <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"white"</span>,<span class="st">"black"</span>,<span class="st">"red"</span>,<span class="st">"purple"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Recode(c)#运行这行便会生成下面的代码，用于将原有的变量改名</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d<span class="sc">$</span>eth.new <span class="ot">&lt;-</span> <span class="fu">Recode</span>(d<span class="sc">$</span>eth,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Non-Hispanic White::"</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Non-Hispanic Black::"</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Other Race - Including Multi-Racial::"</span>, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Mexican American::"</span>, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Other Hispanic::"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="at">to.numeric =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> c.new <span class="ot">&lt;-</span> <span class="fu">Recode</span>(c,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"white::"</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"black::"</span>, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"red::"</span>, </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"purple::"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="at">to.numeric =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>NHSIII的数据如何计算合并权重 NHSIII是1999年以前的数据，是以3年为一个周期。计算权重时需要以年来，而不是year circle。例如1994-1996，2001-2002，2009-2010，此时总共3+2+2=7年，所以1994-1996的权重是3/7×wt3yr，其余的是2/7×wt2yr。但是如何同时涉及到1999和2001时，这两个year circle要合并算作4年，用wt4yr来计算。</p></li>
<li><p><u><strong>选择行和列</strong></u><br>
可以用nhanesR里的select_row函数来选择行,drop_row来删除行</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d0 <span class="ot">&lt;-</span> <span class="fu">db_demo</span>(<span class="at">years =</span> <span class="dv">1999</span><span class="sc">:</span><span class="dv">2003</span>,<span class="at">ageyr =</span> <span class="st">"age"</span>,<span class="at">sex =</span> T,<span class="at">eth1 =</span> T,<span class="at">Year =</span> T,<span class="at">poverty =</span> T)<span class="co">#直接提取1999-2003的所有人口学数据，指定需要出现的列</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d1 <span class="ot">&lt;-</span> <span class="fu">select_row</span>(x,x<span class="sc">$</span>Year<span class="sc">==</span><span class="st">"1999-2000"</span> <span class="sc">&amp;</span> x<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">50</span>)<span class="co">#选择x中年份为1999-2000，年龄大于等于50岁的数据行</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d1 <span class="ot">&lt;-</span> <span class="fu">select_row</span>(x,x<span class="sc">$</span>Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1999-2000"</span>,<span class="st">"2001-2002"</span>))<span class="co">#同时设置多个筛选条件</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d2 <span class="ot">&lt;-</span> <span class="fu">drop_row</span>(x,x<span class="sc">$</span>Year<span class="sc">==</span><span class="st">"2001-2002"</span>)<span class="co">#去除x中年份为2001-2002的数据</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d3 <span class="ot">&lt;-</span> <span class="fu">drop_row</span>(d0,<span class="fu">is.na</span>(d0<span class="sc">$</span>poverty))<span class="co">#用drop_row也可以去除缺失值</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="数据的合并" class="level4">
<h4 class="anchored" data-anchor-id="数据的合并">数据的合并</h4>
<p>第一种方法是直接用管道操作符添加数据</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d1 <span class="ot">&lt;-</span> <span class="fu">db_demo</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1999</span><span class="sc">:</span><span class="dv">2003</span>,<span class="dv">2007</span>),<span class="at">Year =</span> T,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               <span class="at">sex =</span> T,<span class="at">ageyr =</span> <span class="st">"age"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">db_cbc</span>(<span class="at">wbc_1000cells.ul =</span> <span class="st">"wbc"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">dex_phenoAge</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#cbc是全血细胞数据，phenoAge是生物学年龄，直接用管道操作符即可不断添加数据</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">head</span>(d1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210030944349.png" class="img-fluid"></p>
<p>第二种方法是先分别提取数据，然后再合并.此时可以<strong>left_join,righ_join,inner_join,full_join</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d1 <span class="ot">&lt;-</span> <span class="fu">db_demo</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1999</span><span class="sc">:</span><span class="dv">2003</span>,<span class="dv">2007</span>),<span class="at">Year =</span> T,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               <span class="at">sex =</span> T,<span class="at">ageyr =</span> <span class="st">"age"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d2 <span class="ot">&lt;-</span> <span class="fu">db_cbc</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">1999</span><span class="sc">:</span><span class="dv">2003</span>,<span class="dv">2007</span>),<span class="at">wbc_1000cells.ul =</span> <span class="st">"wbc"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d3 <span class="ot">&lt;-</span> <span class="fu">dex_phenoAge</span>()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d4 <span class="ot">&lt;-</span> <span class="fu">Left_Join</span>(d1,d2,d3)<span class="co">#left_join只匹配d1的序号,可以看到d4和d1具有同样的行数</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d5 <span class="ot">&lt;-</span> <span class="fu">Right_Join</span>(d1,d2,d3)<span class="co">#先与d2合并，再与d3合并，最终数据以d3为准</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d6 <span class="ot">&lt;-</span> <span class="fu">Inner_Join</span>(d1,d2,d3)<span class="co">#以三者共有的数据为准进行合并</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d7 <span class="ot">&lt;-</span> <span class="fu">Full_Join</span>(d1,d2,d3)<span class="co">#所有的数据一起合并</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d8 <span class="ot">&lt;-</span> <span class="fu">Left_Join</span>(d2,d1) <span class="co">#会显示d1人口学数据中有4028人没有白细胞计数的数据，便于画流程图</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># d2   :37247 ; d1:41275(-4028) </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d8 <span class="ot">&lt;-</span> <span class="fu">Left_Join</span>(d2,d1,<span class="at">inspect =</span> <span class="fu">c</span>(<span class="st">"age"</span>,<span class="st">"sex"</span>)) <span class="co">#可以查看某个变量在d1合并到d2前后的变化，绿色表示减少，红色表示增多</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#其他类型的join也可以inspect</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/20221003101606.png" class="img-fluid" width="295"></p>
</section>
<section id="添加新列" class="level4">
<h4 class="anchored" data-anchor-id="添加新列">添加新列</h4>
<p>1.添加新列的主要作用为对原始数据的某些值进行判断，增加一些新的变量，例如是否是老年，某些指标是否升高等。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">db_demo</span>(<span class="at">years =</span> <span class="dv">1999</span>,<span class="at">ageyr =</span> <span class="st">"age"</span>,<span class="at">sex =</span> T,<span class="at">Year =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">db_cbc</span>(<span class="at">wbc_1000cells.ul =</span> <span class="st">"wbc"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">drop_row</span>(d,<span class="fu">is.na</span>(d<span class="sc">$</span>wbc))<span class="co">#去除白细胞计数的缺失值</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="do">####以10为界值，判断白细胞数是否升高####</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">add_col</span>(d,<span class="at">colname =</span> <span class="st">"wbc_level"</span>,<span class="at">value =</span> <span class="st">"yes"</span>,<span class="at">condition =</span> d<span class="sc">$</span>wbc <span class="sc">&gt;</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">add_col</span>(<span class="at">colname =</span> <span class="st">"wbc_level"</span>,<span class="at">value =</span> <span class="st">"no"</span>,<span class="at">condition =</span> d<span class="sc">$</span>wbc <span class="sc">&lt;=</span> <span class="dv">10</span>)<span class="co">#新增一列，列名为wbc_level，白细胞大于10的时候为yes，小于等于10的时候为no</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="do">####对于白细胞，男性的界限为10，女性的界限是9####</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ck <span class="ot">&lt;-</span> (d<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"Male"</span> <span class="sc">&amp;</span> d<span class="sc">$</span>wbc <span class="sc">&gt;</span> <span class="dv">10</span>) <span class="sc">|</span> (d<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"Female"</span> <span class="sc">&amp;</span> d<span class="sc">$</span>wbc <span class="sc">&gt;</span><span class="dv">10</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d1 <span class="ot">&lt;-</span> <span class="fu">add_col</span>(d,<span class="at">colname =</span> <span class="st">"wbc_level"</span>,<span class="at">value =</span> <span class="st">"yes"</span>,<span class="at">condition =</span> ck) <span class="sc">|&gt;</span> </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">add_col</span>(<span class="at">colname =</span> <span class="st">"wbc_level"</span>,<span class="at">value =</span> <span class="st">"no"</span>,<span class="at">condition =</span> <span class="fu">is.na</span>(d1<span class="sc">$</span>wbc_level),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>           <span class="at">position =</span> <span class="dv">2</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#先把男性和女性的yes指定了，然后剩下的NA全部是no。position可以指定新增的列的位置</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>2.也可以用于一些疾病的诊断的添加，例如睡眠呼吸暂停综合征👇</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">db_slq</span>(<span class="at">years =</span> <span class="dv">2005</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="at">sleep_disorder_sleep_apnea =</span> <span class="st">"apnea"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="at">how_often_do_you_snort_or_stop_breathing =</span> <span class="st">"stop_breathing"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>             <span class="at">how_often_feel_overly_sleepy_during_day =</span> <span class="st">"sleepy"</span>)<span class="co">#提取睡眠呼吸暂停相关的数据</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#将原来的变量值进行重编码👇</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># Recode(d$apnea) </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d<span class="sc">$</span>apnea <span class="ot">&lt;-</span> <span class="fu">Recode</span>(d<span class="sc">$</span>apnea,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"sleep apnea::yes"</span>, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA::"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="at">to.numeric =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Recode(d$stop_breathing)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d<span class="sc">$</span>stop_breathing <span class="ot">&lt;-</span> <span class="fu">Recode</span>(d<span class="sc">$</span>stop_breathing,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"never::no"</span>, </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"frequently (5 or more nights/week)::yes"</span>, </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"rarely (1-2 nights/week)::no"</span>, </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"occasionally (3-4 nights/week)::yes"</span>, </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA::"</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="at">to.numeric =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Recode(d$sleepy)</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d<span class="sc">$</span>sleepy <span class="ot">&lt;-</span> <span class="fu">Recode</span>(d<span class="sc">$</span>sleepy,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"rarely (1 time a month)::no"</span>, </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"never::no"</span>, </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"almost always (16-30 times a month)::yes"</span>, </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"sometimes (2-4 times a month)::yes"</span>, </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"often (5-15 times a month)::yes"</span>, </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA::"</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="at">to.numeric =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d<span class="sc">$</span>osas <span class="ot">&lt;-</span> <span class="fu">paste0</span>(d<span class="sc">$</span>apnea,<span class="st">"~"</span>,d<span class="sc">$</span>stop_breathing,<span class="st">"~"</span>,d<span class="sc">$</span>sleepy)<span class="co">#将三个指标合并在一起</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Recode(d$osas) #开始筛选诊断标准，三个中任意一个为yes就可以诊断为OSAS</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d<span class="sc">$</span>osas <span class="ot">&lt;-</span> <span class="fu">Recode</span>(d<span class="sc">$</span>osas,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA~no~no::no"</span>, </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA~no~yes::yes"</span>, </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"yes~no~no::yes"</span>, </span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"yes~NA~yes::yes"</span>, </span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA~yes~no::yes"</span>, </span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA~NA~yes::yes"</span>, </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"yes~yes~yes::yes"</span>, </span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA~yes~yes::yes"</span>, </span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA~NA~no::no"</span>, </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA~no~NA::no"</span>, </span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"yes~no~yes::yes"</span>, </span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"yes~yes~no::yes"</span>, </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"NA~NA~NA::NA"</span>, </span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"yes~NA~no::yes"</span>,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="at">to.numeric =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>3.也可以用于某种条件下进行分组. quant可以执行分位数的计算</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">db_demo</span>(<span class="at">years =</span> <span class="dv">1999</span>,<span class="at">sex =</span> <span class="st">"sex"</span>,<span class="at">ageyr =</span> <span class="st">"age"</span>,<span class="at">psu_strat =</span> F) <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">db_cbc</span>(<span class="at">wbc_1000cells.ul =</span> <span class="st">"wbc"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">drop_row</span>(d,<span class="fu">is.na</span>(d<span class="sc">$</span>wbc))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#根据白细胞的均值分为2组</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">add_col</span>(d,<span class="st">"wbc2"</span>,<span class="st">"high"</span>,d<span class="sc">$</span>wbc <span class="sc">&gt;</span> <span class="fu">mean</span>(d<span class="sc">$</span>wbc)) <span class="sc">|&gt;</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">add_col</span>(<span class="st">"wbc2"</span>,<span class="st">"low"</span>,d<span class="sc">$</span>wbc <span class="sc">&lt;=</span> <span class="fu">mean</span>(d<span class="sc">$</span>wbc))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co">#将白细胞按照四分位数分成4组，并且编码为Q1，Q2，Q3，Q4</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># quant(d$wbc)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d<span class="sc">$</span>wbcQ <span class="ot">&lt;-</span> <span class="fu">quant</span>(d<span class="sc">$</span>wbc, <span class="at">n =</span> <span class="dv">4</span>,<span class="at">Q =</span> <span class="cn">TRUE</span>,<span class="at">round=</span><span class="dv">3</span>)<span class="co">#n=4即进行四分位数计算</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d<span class="sc">$</span>wbcQ.median <span class="ot">&lt;-</span> <span class="fu">quant.median</span>(d<span class="sc">$</span>wbc, <span class="at">n =</span> <span class="dv">4</span>,<span class="at">round=</span><span class="dv">3</span>)<span class="co">#计算每个四分位间距的中位数</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/20221003161242.png" class="img-fluid" width="441"></p>
</section>
</section>
<section id="数据提取汇总" class="level2">
<h2 class="anchored" data-anchor-id="数据提取汇总">数据提取汇总</h2>
<p>提取的数据可以进行叠加，例如db_demo() |&gt; db_drtot()可以不断增加不同类型的数据</p>
<section id="提取人口学数据" class="level3">
<h3 class="anchored" data-anchor-id="提取人口学数据">提取人口学数据</h3>
<p>使用db_demo(),需要的列就指定为TRUE</p>
</section>
<section id="提取饮食数据" class="level3">
<h3 class="anchored" data-anchor-id="提取饮食数据">提取饮食数据</h3>
<p>使用<strong>db_drtot()</strong>, day= 可以指定是一天的饮食数据还是两天的饮食数据，默认是2天的数据。fun= 可以计算mean、sum、alone（2天的都分开显示），默认是sum。both2days表示是否只要2天都有的数据，默认为TRUE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">db_drtot</span>(<span class="at">years =</span> <span class="dv">2005</span>,<span class="at">calcium_mg =</span> T,<span class="at">Year =</span> T,<span class="at">fun =</span> <span class="st">"alone"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(x)<span class="co">#alone显示2天的数据</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210031742905.png" class="img-fluid" width="532"></p>
<p>如果both2days为FALSE，则仅1天有数据的行也会显示</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">db_drtot</span>(<span class="at">years =</span> <span class="dv">2005</span>,<span class="at">calcium_mg =</span> T,<span class="at">Year =</span> T,<span class="at">both2days =</span> F,<span class="at">fun =</span> <span class="st">"alone"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">head</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210031745536.png" class="img-fluid" width="527"></p>
</section>
<section id="提取生存数据" class="level3">
<h3 class="anchored" data-anchor-id="提取生存数据">提取生存数据</h3>
<p>db_mort()用于提取生存数据，生存数据主要包括7列。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> mort <span class="ot">&lt;-</span> <span class="fu">db_demo</span>(<span class="at">years =</span> <span class="dv">2005</span>,<span class="at">ageyr =</span> <span class="st">"age"</span>,<span class="at">sex =</span> <span class="st">"sex"</span>,<span class="at">psu_strat =</span> F) <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">db_mort</span>(<span class="at">years =</span> <span class="dv">2005</span>) <span class="co">#先人口学数据，然后添加上生存数据</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="提取饮酒相关数据" class="level3">
<h3 class="anchored" data-anchor-id="提取饮酒相关数据">提取饮酒相关数据</h3>
<p>1.提取g/day</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">db_drtot</span>(<span class="at">years=</span><span class="dv">2005</span>,<span class="at">alcohol_g =</span> <span class="st">"alcohol"</span>,<span class="at">day =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">both2days =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>2.提取drink/day的数据.注意不是cup/day</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">db_fped</span>(<span class="at">a_drinks =</span> T,<span class="at">years =</span> <span class="dv">2005</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d1 <span class="ot">&lt;-</span> <span class="fu">db_Alcohol.drinks</span>(<span class="at">years =</span> <span class="dv">2005</span>)<span class="co">#这个是最准确的，drinks/day</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>3.酒精使用程度分类</p>
<ul>
<li><p>current heavey alcohol use<br>
≥3 drinks perday for female<br>
≥4 for male<br>
binge drinking on 5 or more days per month</p></li>
<li><p>current moderate alcohol use<br>
≥2 drinks per day for female<br>
≥3 for male<br>
binge drinking ≥ 2days per month</p></li>
<li><p>current mild alcohol use<br>
not meet the above</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> t <span class="ot">&lt;-</span> <span class="fu">diag_alcohol.user</span>(<span class="at">years =</span> <span class="dv">2005</span>,<span class="at">binge =</span> T,<span class="at">Year =</span> T)<span class="co">#可以修改mild,moderate，heavey的判断标准，可以设定是否有binge这个程度</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="黄酮类化合物数据提取" class="level3">
<h3 class="anchored" data-anchor-id="黄酮类化合物数据提取">黄酮类化合物数据提取</h3>
<p>黄酮类化合物数据库Flavonoid。之前只有2007-2010的数据，2022年夏天出了2017-2018的数据。包含6种黄酮类的29种化合物的饮食摄入数据。day表示提取1天还是两天的数据，要么第一天，要么两天同时使用；当使用两天时，fun可以指定计算均值（mean）还是和（sum）；</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> fl <span class="ot">&lt;-</span> <span class="fu">db_flavonoids</span>(<span class="at">Daidzein_mg =</span> <span class="st">"Daidzein"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="重金属数据提取" class="level3">
<h3 class="anchored" data-anchor-id="重金属数据提取">重金属数据提取</h3>
<p>从pbcd数据中提取重金属相关的数据，使用db_PbCd()提取，数据从2005年开始，如铬、汞、锰等重金属。注意：当使用PbCd数据时，2013-2014和2015-2016两年，需要使用wtsh2yr权重，因为这两年12岁以上的参与者只有1/2的样本进行了检测，所以有一个单独的wtsh2yr，而1-11岁的wtsh2yr等同于MEC权重。所以涉及这两个year circle时使用特殊权重wtsh2yr，其余的circle使用MEC权重。dp_PbCd()中提供了权重weight = T即可自动提供权重(仅原始权重，合并权重按原方法计算）</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">db_PbCd</span>(<span class="at">years =</span> <span class="dv">2013</span>,<span class="at">blood_cadmium_ug.l =</span> T,<span class="at">weight =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">drop_row</span>(<span class="fu">is.na</span>(x<span class="sc">$</span>blood_cadmium_ug.l))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="药物搜索与提取" class="level3">
<h3 class="anchored" data-anchor-id="药物搜索与提取">药物搜索与提取</h3>
<p>先检索，看是不是自己想要的药物，再Drug()去提取。remove.other如果是F，则如果一个人既吃了检索的药物，又吃了其他药，就会占多行。如果=T，则会值保留检索的药物（仅删除同时出现的情况）。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">browse_rxq_Drug</span>()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">browse_rxq_Rx</span>()<span class="co">#处方文件</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">drug_search</span>(<span class="st">"antibiotic"</span>,<span class="at">years =</span> <span class="dv">2015</span>)<span class="co">#检索包含关键词antibiotic的药物</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">Drug</span>(<span class="st">"antibiotic"</span>,<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">drugname =</span> T,<span class="at">remove.other =</span> T)<span class="co">#提取关键词的药物</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">drug_anti.infectives</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">drugname =</span> T,<span class="at">dcn =</span> T)<span class="co">#提取抗感染药物</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="指标计算汇总" class="level2">
<h2 class="anchored" data-anchor-id="指标计算汇总">指标计算汇总</h2>
<section id="健康饮食指数healthy-eating-index" class="level3">
<h3 class="anchored" data-anchor-id="健康饮食指数healthy-eating-index">健康饮食指数（Healthy eating index）</h3>
<p><a href="https://epi.grants.cancer.gov/hei/">健康饮食指数的介绍</a>。HEI有两个版本2015和2010，2015是最新的版本，以符合2015-2020美国人膳食指南。算法包括简单算法和population ratio method，简单算法又包括Per day和Per person，per day就是在day = 1，Per person就是day=c(1,2), 对应method = “ssum”和”partio”.默认会给所有成分的评分，如果component = F就只给total score</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">dex_HEI</span>(<span class="at">years =</span> <span class="dv">2011</span>,<span class="at">version =</span> <span class="dv">2015</span>,<span class="at">method =</span> <span class="st">"ssum"</span>,<span class="at">day =</span> <span class="dv">1</span>,<span class="at">dietary =</span> <span class="st">"tot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="咖啡数据提取" class="level3">
<h3 class="anchored" data-anchor-id="咖啡数据提取">咖啡数据提取</h3>
<p>db_coffee(). 咖啡数据最好是在1999年以后进行。包含了是否添加咖啡因，是否加糖，是否加脂，加奶等，以及咖啡的种类，如卡布奇诺、摩卡、玛奇朵等等。 如何确定并识别咖啡数据？–使用的是FNDDs数据里的食物编码921开头的是coffee（用于写文章说明数据来源） 咖啡摄入的克数转化为杯数？–以6盎司为一杯</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> co <span class="ot">&lt;-</span> <span class="fu">db_coffee</span>(<span class="at">years =</span> <span class="dv">2003</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">day =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="co">#要么提取第一天，要么提取两天的</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">fun =</span> <span class="st">"mean"</span>, <span class="co">#默认取两天的均值</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">unit =</span> <span class="st">"g"</span>) <span class="co">#g或者cup单位，默认是g</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="饮食炎症指数的提取" class="level3">
<h3 class="anchored" data-anchor-id="饮食炎症指数的提取">饮食炎症指数的提取</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> di <span class="ot">&lt;-</span> <span class="fu">dex_DII</span>(<span class="at">years =</span> <span class="dv">2005</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="肾小球滤过率egfr" class="level3">
<h3 class="anchored" data-anchor-id="肾小球滤过率egfr">肾小球滤过率eGFR</h3>
<p>dex_eGFR()里提供了10种计算eGFR的方法，如Cockcroft_Gault,CKD_EPI_Scr,Schwartz等等，可以在mothod=里限定，默认是CKD_EPI_Scr。如果需要计算多种方法的eGFR，只需要method = c(,)。理论上来说推荐使用血肌酐计算滤过率，方法最推荐MDRD和CG方法</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> egf <span class="ot">&lt;-</span> <span class="fu">dex_eGFR</span>(<span class="at">years =</span> <span class="dv">2005</span>,<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"CKD_EPI_Scr"</span>,<span class="st">"BIS1_Scr"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="益生元益生菌合生元" class="level3">
<h3 class="anchored" data-anchor-id="益生元益生菌合生元">益生元、益生菌、合生元</h3>
<p><a href="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/PIIS0016508521006612.pdf">相关参考文献</a>。FDA不监管益生菌，但是监管益生元（如乳果糖），所以如果只研究益生菌，只需要检索膳食补充剂的数据，而益生元的话需要检索药品，通过关键词来匹配是否含有益生元成分。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> pr <span class="ot">&lt;-</span> <span class="fu">DSD</span>(<span class="at">years =</span> <span class="dv">2016</span>,<span class="at">probiotic =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="疾病诊断汇总" class="level2">
<h2 class="anchored" data-anchor-id="疾病诊断汇总">疾病诊断汇总</h2>
<section id="代谢综合征" class="level3">
<h3 class="anchored" data-anchor-id="代谢综合征">代谢综合征</h3>
<p>使用diag_MetS() ，代谢综合征有两种计算方法，一种是ATP（美国的）和IDF（国际的）。不同年龄的计算公式不同，children and adolescent有单独的一套标准（modified ATP和IDF）。默认使用ATP标准。将分别计算&gt;=16岁和10-16岁的诊断结果</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">diag_MetS</span>(<span class="at">years =</span> <span class="dv">2015</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210042049416.png" class="img-fluid" width="285"></p>
</section>
<section id="高血压" class="level3">
<h3 class="anchored" data-anchor-id="高血压">高血压</h3>
<p>diag_Hypertension().</p>
<p>具体的高血压诊断标准：任意一个满足</p>
<ol type="1">
<li>是否使用高血压药物</li>
<li>doctor told you or take drug</li>
<li>bpx血压测量。分为mean和times，在method = 里设定</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> h <span class="ot">&lt;-</span> <span class="fu">diag_Hypertension</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">systolic =</span> <span class="dv">140</span>,<span class="at">diastolic =</span> <span class="dv">90</span>,<span class="at">n=</span><span class="dv">3</span>) <span class="co">#设定舒张压和收缩压阈值</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> h <span class="ot">&lt;-</span> <span class="fu">diag_Hypertension</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">method =</span> <span class="st">"mean"</span>) <span class="co">#使用均值来诊断</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> h <span class="ot">&lt;-</span> <span class="fu">diag_Hypertension</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">method =</span> <span class="st">"times"</span>,<span class="at">n=</span><span class="dv">3</span>) <span class="co">#使用3次测量来判断是否患有高血压</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="高脂血症" class="level3">
<h3 class="anchored" data-anchor-id="高脂血症">高脂血症</h3>
<p>包块高甘油三酯血症、高胆固醇血症、和使用降脂药</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">diag_Hyperlipidemia</span>(<span class="at">years =</span> <span class="dv">2015</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="糖尿病" class="level3">
<h3 class="anchored" data-anchor-id="糖尿病">糖尿病</h3>
<p>糖尿病诊断标准</p>
<ol type="1">
<li>doctor told you have DM</li>
<li>res_HbA1c：糖化血红蛋白</li>
<li>fast glucose：空腹血糖。IFG为空腹血糖受损</li>
<li>glucose随机血糖值</li>
<li>OGTT2小时，IGT为糖耐量受损</li>
<li>drug use：antidiabetic 如果使用了实验室检查（2~5条）作为诊断标准，则需要使用实验室的权重，可能会丧失一些数据，这时候如果仅仅把糖尿病作为协变量来使用的话，可以只用报道的（1和6条），把其他的变量都设置为FALSE即可</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">diag_DM</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">HbA1c =</span> F,<span class="at">fast_glu =</span> F,<span class="at">OGTT2 =</span> F,<span class="at">rand_glu =</span> F)<span class="co">#将实验室结果不作为诊断指标</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="吸烟" class="level3">
<h3 class="anchored" data-anchor-id="吸烟">吸烟</h3>
<p>分为三种吸烟的类型</p>
<ol type="1">
<li>never：smoked less than 100 cigarettes in life</li>
<li>former：smoked more than 100 cigarettes in life and smoke not at all now</li>
<li>now：smoked more than 100 cigarettes in life and smoke some days or every day</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> s <span class="ot">&lt;-</span> <span class="fu">diag_smoke</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">smoking_years =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="抑郁" class="level3">
<h3 class="anchored" data-anchor-id="抑郁">抑郁</h3>
<p>使用PHQ-9抑郁筛查量表</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> x <span class="ot">&lt;-</span> <span class="fu">diag_PHQ9</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">cut =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ckd" class="level3">
<h3 class="anchored" data-anchor-id="ckd">CKD</h3>
<p>诊断标准采用2021年的KDIGO，有两种标准，eGFR和尿白蛋白。两者结合可以判断预后。如果需要采用白蛋白的数据，需要是2005年以后的才行。ckd = 为CKD的最小诊断标准，默认为达到A2和G3a，可以自己调整</p>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210042157840.png" class="img-fluid" width="363"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> e <span class="ot">&lt;-</span> <span class="fu">diag_CKD</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">ckd =</span> <span class="fu">c</span>(<span class="st">"A2"</span>,<span class="st">"G3a"</span>),</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>               <span class="at">show_prognosis =</span> T,<span class="at">eGFR_method =</span> <span class="st">"CKD_EPI_Scr"</span>)<span class="co">#默认的eGFR的计算方法</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mafld代谢功能障碍相关脂肪性肝病" class="level3">
<h3 class="anchored" data-anchor-id="mafld代谢功能障碍相关脂肪性肝病">MAFLD代谢功能障碍相关脂肪性肝病</h3>
<p>NAFLD与MAFLD，2020年已经将NAFLD建议规纳入MAFLD中。NAFLD需要排除过量饮酒和其他原因的肝脏疾病，MAFLD的诊断则是基于超重/肥胖或T2DM亦或存在两个及以上代谢心血管危险因素。“MAFLD”这一命名强调了<u><strong>肥胖、胰岛素抵抗、血脂异常、T2DM和系统性全身低度炎症反应</strong></u>在脂肪性肝病发生发展中的重要作用。因此，需要根据不同的标准和定义重新对脂肪性肝病进行临床分类。尽管大多数患者同时符合MAFLD与NAFLD的诊断标准 (MAFLD+NAFLD+)，但是仍有部分患者仅符合NAFLD诊断标准(MAFLD-NAFLD+) 或仅符合MAFLD诊断标准(MAFLD+NAFLD-)。也就是说，并不是所有的NAFLD都可以直接归类为MAFLD，反之亦然。</p>
<p>MAFLD的诊断标准：<a href="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/nss-13-103.pdf">参考文献.pdf</a></p>
<ol type="1">
<li>主要标准：Steatosis（必须有肝脂肪变的证据）：用的超声CAP衰减指数</li>
<li>次要标准：满足任意一个
<ol type="1">
<li><p>BMI：&gt;25</p></li>
<li><p>DM</p></li>
<li><p>metabolic dysfunction: 6个指标（waist，hypertension，hyperlipidemia，low HDL-C level，prediabetes（空腹血糖受损和糖耐量受损），hypersensitive C-reactive protein level&gt;2mg/L</p></li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">diag_MAFLD</span>(<span class="at">years =</span> <span class="dv">2015</span>)<span class="co">#其余参数可以指定是否返回诊断条件的结果</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="fped数据库" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="fped数据库">FPED数据库</h2>
<p>Food pattern equivalent database：食物模式等量数据库；将NHANES中的食物和饮料转化为37种USDA食物模式组分。主要包含9类：Fruit(cup), vegetables(cup), grains(oz), dairy(cup), protein food(oz), added sugars(tsp), oils(grams), solid fats(grams), alcoholic drinks(no.)</p>
<p>实际是NHANES的iff结合FNDDs得出的结果，所以同样包含两天的数据。1999-2002只有1天的数据。权重有各自的权重</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210051108837.png" class="img-fluid figure-img" width="302"></p>
<p></p><figcaption class="figure-caption margin-caption">数据提取选项，如果选择both2day=T，那么只有两天均有数据时才会保留</figcaption><p></p>
</figure>
</div>
<ul>
<li>iff和tot的区别：两者均不包括从膳食补充剂、药物或普通饮用水中摄取的营养<br>
tot是Total Nutrient Intakes: 包括每天从食物和饮料中摄入的总营养，摄入的总水量<br>
iff是Individual Foods Files：包括单个食物的类型和数量的详细信息，以及每种食物的营养含量<br>
2003年以后才会有2天的数据</li>
</ul>
<section id="fruit" class="level3">
<h3 class="anchored" data-anchor-id="fruit">Fruit</h3>
<p>fruit分为intact/cut fruit, juice, total。Citrus, Melons and Berries; Other Fruits; Fruit juice</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">db_fped</span>(<span class="at">years =</span> <span class="dv">2005</span>,<span class="at">dietary =</span> <span class="st">"tot"</span>,<span class="at">day =</span> <span class="dv">1</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>              <span class="at">f_whole =</span> T,<span class="at">f_citmlb =</span> T,<span class="at">f_other =</span> T,<span class="at">f_juice =</span> T,<span class="at">f_total =</span> T)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#citmlb,other,whole都是整果（intact/cut fruit), whole=citmlb+other</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="vegetables" class="level3">
<h3 class="anchored" data-anchor-id="vegetables">Vegetables</h3>
<p>蔬菜分为6类：</p>
<ul>
<li><p>dark green：v_drkgr</p></li>
<li><p>red orange: v_redor_tomato,v_redor_other, v_redor_total</p></li>
<li><p>starchy: v_starchy_potato, v_starchy_other, v_starchy_total</p></li>
<li><p>other: v_other</p></li>
<li><p>total: v_total（不包括legumes）</p></li>
<li><p>legumes: v_legumes</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">db_fped</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">v_drkgr =</span> T) <span class="co">#以v_开头</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grains" class="level3">
<h3 class="anchored" data-anchor-id="grains">Grains</h3>
<p>包括整谷物（g_whole), refined or non-whole grains（g_refined）, 和g_total, 单位是盎司oz</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> g <span class="ot">&lt;-</span> <span class="fu">db_fped</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">g_whole =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dairy" class="level3">
<h3 class="anchored" data-anchor-id="dairy">Dairy</h3>
<p>乳制品单位是cup。包括d_milk, d_yogurt, d_cheese, d_total</p>
</section>
<section id="protein-foods" class="level3">
<h3 class="anchored" data-anchor-id="protein-foods">Protein foods</h3>
<p>蛋白质类，单位是盎司。</p>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210051329370.png" class="img-fluid" width="615"><br>
主要分为植物蛋白、肉类、鸡蛋。肉类又分为腌肉、生肉、内脏、幼禽、海产品（高低n-3脂肪酸）；植物蛋白包括豆制品，坚果类，豆类</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">db_fped</span>(<span class="at">years =</span> <span class="dv">2005</span>,<span class="at">pf_curedmeat =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="others" class="level3">
<h3 class="anchored" data-anchor-id="others">Others</h3>
<ul>
<li><p>add sugars(tsp): 添加糖—– add_sugars</p></li>
<li><p>Oils(gram): oils</p></li>
<li><p>Solid fat(grams)：固态脂肪 solid_fat</p></li>
<li><p>alcoholic drinks(no.): a_drinks; alcoholic beverage</p></li>
</ul>
</section>
</section>
<section id="易侕" class="level2">
<h2 class="anchored" data-anchor-id="易侕">易侕</h2>
<ul>
<li><p>如何将nhanesR的数据直接写入到易侕中<br>
先整理好数据，然后使用write.yier(), 指定导出的df，可以修改file的名字和project的名字。然后就会在易侕的Analysis文件下生成一个project的文件夹。其中有一个txt文件和一个excel文件，txt是数据文件，excel是变量名的对照表。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> newproject <span class="ot">&lt;-</span> <span class="fu">db_demo</span>(<span class="at">years =</span> <span class="dv">2015</span>,<span class="at">Year =</span> T,<span class="at">ageyr =</span> <span class="st">"age"</span>,<span class="at">sex =</span> <span class="st">"sex"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">db_Alcohol.drinks</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">dex_DII</span>()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co"># Factor(new)</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> new<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">factor</span>(new<span class="sc">$</span>Year, <span class="fu">c</span>(<span class="st">'2015-2016'</span>))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> new<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(new<span class="sc">$</span>sex, <span class="fu">c</span>(<span class="st">'Male'</span>, <span class="st">'Female'</span>))</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">write.yier</span>(<span class="at">df =</span> x,<span class="at">file =</span> <span class="st">"mydata"</span>)<span class="co">#导出数据</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="文献复现" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="文献复现">文献复现</h2>
<section id="中性粒细胞减少的流行病学" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="中性粒细胞减少的流行病学">1. 中性粒细胞减少的流行病学</h3>
<p>Prevalence of Neutropenia in the U.S. Population: Age, Sex, Smoking, Status, and Ethnic Differences–<a href="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/0003-4819-146-7-200704030-00004.pdf">参考文献</a></p>
<p>年份：1999-2004，采用的权重是MEC权重，1999-2002：wtmec4yr×2/3；2003-2004：wtmec2yr×1/3</p>
<section id="提取数据" class="level4">
<h4 class="anchored" data-anchor-id="提取数据">提取数据</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(nhanesR)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(reshape2)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(do)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d_demo <span class="ot">&lt;-</span> <span class="fu">db_demo</span>(<span class="at">years =</span> <span class="dv">1999</span><span class="sc">:</span><span class="dv">2004</span>, <span class="at">ageyr =</span> <span class="st">"age"</span>, <span class="at">sex =</span> <span class="st">"sex"</span>, <span class="at">eth1 =</span> <span class="st">"eth"</span>, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                   <span class="at">wtmec4yr =</span> T,<span class="at">wtmec2yr =</span> T,<span class="at">Year =</span> T)<span class="co">#提取人口学数据</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d_demo<span class="sc">$</span>nhs_wt <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(d_demo<span class="sc">$</span>Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1999-2000"</span>,<span class="st">"2001-2002"</span>),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                         <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>d_demo<span class="sc">$</span>wtmec4yr,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>d_demo<span class="sc">$</span>wtmec2yr)<span class="co">#计算合并权重</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d_demo <span class="ot">&lt;-</span> <span class="fu">drop_col</span>(d_demo,<span class="st">"wtmec4yr"</span>,<span class="st">"wtmec2yr"</span>)<span class="co">#删除原来的两列权重</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d_demo <span class="ot">&lt;-</span> d_demo[d_demo<span class="sc">$</span>age<span class="sc">&gt;=</span><span class="dv">1</span>,]<span class="co">#研究的是1岁即以上的人群，进行了进一步的MEC检查</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d_cbc1 <span class="ot">&lt;-</span> <span class="fu">db_cbc</span>(<span class="at">years =</span> <span class="dv">1999</span><span class="sc">:</span><span class="dv">2004</span>,<span class="at">wbc_1000cells.ul =</span> <span class="st">"wbc"</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">Segmented_neutrophils_number_1000cells.ul =</span> <span class="st">"Neu"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">lymphocyte_number_1000cells.ul =</span> <span class="st">"Lym"</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">hemoglobin_g.dl =</span> <span class="st">"Hb"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>                 <span class="at">Platelet_count_1000cells.uL =</span> <span class="st">"Plt"</span>)<span class="co">#提取实验室检查血液的数据</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nrow</span>(d_demo)<span class="sc">-</span><span class="fu">nrow</span>(d_cbc)<span class="co">#被告知去MEC的有29608人，其中没有去做MEC检查的有1668人</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d_cbc <span class="ot">&lt;-</span> <span class="fu">complete.data</span>(d_cbc1)<span class="co">#😊移除缺失值，显示有2715个NA。文中报告了3个异常值，但其实应该没有</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">nrow</span>(d_cbc) <span class="co"># 25225 complete cbc</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d <span class="ot">&lt;-</span> <span class="fu">Inner_Join</span>(d_demo,d_cbc)<span class="co">#合并人口学数据和实验室数据</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="复杂抽样的加权" class="level4">
<h4 class="anchored" data-anchor-id="复杂抽样的加权">复杂抽样的加权</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> nhs <span class="ot">&lt;-</span> <span class="fu">svy_design</span>(<span class="at">data =</span> d) <span class="co">#需要将合并权重变量名设置为nhs_wt，psu和strata都是指定好的</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="总人口和缺失人群分析" class="level4">
<h4 class="anchored" data-anchor-id="总人口和缺失人群分析">总人口和缺失人群分析</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">svy_population</span>(<span class="at">design =</span> nhs)<span class="co">#😊participants代表的总人口数</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#The 25 222 NHANES participants with valid hematologic indices represented 253.2 million noninstitutionalized residents of the United States</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co"># Recode(d$eth)</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> d<span class="sc">$</span>eth <span class="ot">&lt;-</span> <span class="fu">Recode</span>(d<span class="sc">$</span>eth,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Non-Hispanic White::white"</span>, </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Non-Hispanic Black::black"</span>, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Other Race - Including Multi-Racial::others"</span>, </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Mexican American::Mexican"</span>, </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="st">"Other Hispanic::others"</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="at">to.numeric =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> miss_seqn <span class="ot">&lt;-</span> d_cbc1<span class="sc">$</span>seqn[<span class="sc">!</span><span class="fu">complete.cases</span>(d_cbc1)]<span class="co">#😊提取出cbc里面缺失了数据的seqn序号</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> demo_miss <span class="ot">&lt;-</span> d_demo[d_demo<span class="sc">$</span>seqn <span class="sc">%in%</span> miss_seqn,]<span class="co">#从d_demo数据里提取缺失的seqn行</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">freq_count</span>(demo_miss,<span class="at">x =</span> <span class="st">"eth"</span>)<span class="co">#😊种族的分布</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> bu_x <span class="ot">&lt;-</span> demo_miss<span class="sc">$</span>age <span class="co">#将年龄进行分组生成新的列age_group</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> demo_miss<span class="sc">$</span>age_group[<span class="fu">bu</span>(<span class="st">'( ,5 ]'</span>)] <span class="ot">&lt;-</span> <span class="st">"&lt;=5"</span>   </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> demo_miss<span class="sc">$</span>age_group[<span class="fu">bu</span>(<span class="st">'( 6, 17]'</span>)] <span class="ot">&lt;-</span> <span class="st">"6-17"</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> demo_miss<span class="sc">$</span>age_group[<span class="fu">bu</span>(<span class="st">'[ 18, )'</span>)] <span class="ot">&lt;-</span> <span class="st">"&gt;=18"</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">freq_count</span>(demo_miss,<span class="at">x =</span> <span class="st">"age_group"</span>)<span class="co">#😁年龄分层的分布</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co">#统计人种的分布其实是看是否有特定的种族缺失太多，例如大量的白人都不来测，这样的话数据的代表性就会很差</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="线性回归比较不同种族细胞计数的变化校正年龄性别" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="线性回归比较不同种族细胞计数的变化校正年龄性别">线性回归比较不同种族细胞计数的变化：校正年龄、性别</h4>
<p>目前得到了两套数据，一套是原始数据d，一套是加权后的数据nhs。如果要<u><strong>修改或者增删数据</strong></u>，都先在原始数据d中修改，之后再转换为加权后的数据nhs。如果要<u><strong>取子集（分层）</strong></u>，就直接在nhs加权数据上操作（使用subset）。采用<a href="https://hyp.is/Q6TrtkSwEe2z2AtF2D6c9w/liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/R%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%AD%E6%96%87%E5%AE%8C%E6%95%B4%E7%89%88%EF%BC%89.pdf">广义线性模型</a>来进行线性回归</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">library</span>(survey)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d<span class="sc">$</span>eth <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>eth,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>,<span class="st">"Mexican"</span>, <span class="st">"others"</span>))<span class="co">#unique(d$eth) |&gt; dput() 可以直接生成levels</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> nhs <span class="ot">&lt;-</span> <span class="fu">svy_design</span>(<span class="at">data =</span> d)<span class="co">#修改完以后再加权</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">svyglm</span>(<span class="at">formula =</span> wbc<span class="sc">~</span>eth <span class="sc">+</span> age <span class="sc">+</span>sex,<span class="at">design =</span> nhs) <span class="sc">|&gt;</span> <span class="fu">summary</span>()<span class="co">#使用survey包的广义线性模型回归</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210052112168.png" class="img-fluid figure-img" width="358"></p>
<p></p><figcaption class="figure-caption margin-caption">线性回归的结果</figcaption><p></p>
</figure>
</div>
<p>根据结果可以得出，白细胞记数的均值，黑人比白人低0.86,墨西哥人比白人高0.17</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#比较中性粒细胞,淋巴细胞同理</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">svyglm</span>(<span class="at">formula =</span> Neu<span class="sc">~</span>eth <span class="sc">+</span> age <span class="sc">+</span>sex,<span class="at">design =</span> nhs) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210052143543.png" class="img-fluid" width="358"></p>
</section>
<section id="table1mean-hematologic-values-by-age-sex-and-ethnic-group" class="level4">
<h4 class="anchored" data-anchor-id="table1mean-hematologic-values-by-age-sex-and-ethnic-group">Table1：Mean Hematologic Values, by Age, Sex, and Ethnic Group</h4>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210052210534.png" class="img-fluid" width="500"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> bu_x <span class="ot">&lt;-</span> d<span class="sc">$</span>age<span class="co">#对年龄进行分组</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d<span class="sc">$</span>age18[<span class="fu">bu</span>(<span class="st">'[ ,18 )'</span>)] <span class="ot">&lt;-</span> <span class="st">"&lt;18"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> d<span class="sc">$</span>age18[<span class="fu">bu</span>(<span class="st">'[ 18, )'</span>)] <span class="ot">&lt;-</span> <span class="st">"&gt;=18"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> nhs <span class="ot">&lt;-</span> <span class="fu">svy_design</span>(<span class="at">data =</span> d)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="fu">svy_mean</span>(<span class="at">design =</span> nhs,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>          <span class="at">x =</span> <span class="st">"wbc"</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sex"</span>,<span class="st">"age18"</span>,<span class="st">"eth"</span>),<span class="at">ci =</span> T) <span class="sc">|&gt;</span> <span class="co">#😊计算均值和置信区间，还有其他参数可以指定</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">dcast</span>(<span class="at">formula =</span> sex<span class="sc">+</span>age18<span class="sc">~</span>eth,<span class="at">value.var =</span> <span class="st">"wbc_CI"</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="co">#转化为table1的格式，左边是性别年龄，上面是种族，中间的值是wbc_CI</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> <span class="co">#白细胞和淋巴细胞同理</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210052248588.png" class="img-fluid"></p>
</section>
</section>
</section>
<section id="检索表" class="level2">
<h2 class="anchored" data-anchor-id="检索表">检索表</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">Left_Join</span>(d1,d2,<span class="at">inspect =</span> <span class="st">""</span>)<span class="co">#合并，查看变量合并前后变化</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">db_demo</span>()<span class="co">#人口学数据</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">db_cbc</span>()<span class="co">#全血细胞类型的数据</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">dex_phenoAge</span>()<span class="co">#生物学年龄</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">add_col</span>()<span class="co">#添加列</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">select_row</span>()<span class="co">#保留某些行,%in%, ==, !==, &gt;=</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">dro_row</span>(<span class="fu">is.na</span>())<span class="co">#去除某些行，如NA等</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">db_slq</span>()<span class="co">#睡眠障碍相关数据</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">db_PbCd</span>()<span class="co">#重金属相关数据</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">db_Alcohol.drinks</span>()<span class="co">#提取酒精使用drinks/day的数据</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">db_drtot</span>(<span class="at">alcohol_g =</span> )<span class="co">#提取酒精使用g/day</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">diag_alcohol.user</span>()<span class="co">#酒精使用程度</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./孟德尔随机化.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">孟德尔随机化</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2022, LiuLinhu</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DrJasonLiu/blogdata">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>