---
title: "nhanesR"
author: "LiuLinhu"
date: "`r Sys.Date()`"
editor_options: 
  chunk_output_type: inline
title-block-banner: true
title-block-banner-color: "#FFDDFF"
description: "A Tutorial for nhanesR Packages to Manipulate Data in NHANES"
fig-cap-location: top
page-layout: full
toc-location: right
---

```{r setup,include=FALSE}
library(kableExtra)
library(knitr)
knitr::opts_chunk$set(prompt = TRUE,collapse = TRUE,warning = FALSE,error = FALSE,comment = "",eval = FALSE)
```

## 1.å®‰è£…é…ç½®nhanesR

```{r}
#| eval=F
library(devtools)
library(nhanesR)
devtools::install_github('yikeshu0611/nhshelp',force=TRUE)
nhshelp::install_nhanesR('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')
config_path("/Users/liulinhu/Desktop/NHANES/2022-08-01/NHANES")#é…ç½®æ•°æ®åº“è·¯å¾„
config_years()#é…ç½®æ•°æ®åº“å¹´ä»½
config_items()#é…ç½®æ•°æ®åº“æ–‡ä»¶ç±»å‹
bu( x,'( 1, 2]')#æŒ‡(1,2], å³xå¤§äº1ï¼Œâ‰¤2
bu( x,'[ , ]')#æŒ‡å¤§äºç­‰äºï¼Œå°äºç­‰äº
```

fpedæ•°æ®æ˜¯**Food Patterns Equivalents Databaseï¼Œ**codebookæ–‡ä»¶é‡Œæ˜¯å…¨éƒ¨å˜é‡çš„å˜é‡å’Œè§£é‡Šï¼›varLabelæ˜¯æ ‡ç­¾çš„è§£é‡Šã€‚

## 2.æ•°æ®è¯»å–

1.  çŸ¥é“å˜é‡åä»¥åŠæ‰€åœ¨çš„æ–‡ä»¶: ä¾‹å¦‚ageçš„å˜é‡åæ˜¯ridageyrï¼Œæ‰€åœ¨çš„æ–‡ä»¶æ˜¯demo_bï¼Œdemo_cç­‰ã€‚
2.  ä»æ–‡ä»¶ä¸­æå–å˜é‡

```{r}
#| eval=F
library(nhanesR)
nhs_tsv('demo',years = 2015:2016)#é€‰æ‹©2015-2016å¹´çš„åŒ…å«demoçš„æ•°æ®ï¼ˆdemographicï¼‰
nhs_tsv("demo\\.",'!~p',years = 1999)#1999å¹´ï¼ŒåŒ…å«"demo."ä½†ä¸åŒ…å«"p"çš„æ•°æ®

```

```{r eval=F}
library(nhanesR)
tsv <- nhs_tsv("demo")#æå–æ‰€æœ‰äººå£å­¦æ•°æ®
nhs_brief(tsv,"age") |> View() #æŸ¥æ‰¾tsvä¸­åŒ…å«ageçš„æ‰€æœ‰ï¼Œä»è€Œç¡®å®šå¹´é¾„å˜é‡åä¸ºridageyr

x <- nhs_read(tsv,"ridageyr:age",
              "riagendr:gender-u",
              "dmqmilit:mili",
              "dmqmiliz:mili",
              codebook = T,)#:åé¢å¯ä»¥é‡å‘½åå˜é‡;codebookå‚æ•°è¡¨ç¤ºæ˜¯å¦è§£ç å˜é‡çš„å«ä¹‰;å¦‚æœå¯¹æŸä¸ªå˜é‡ä¸æƒ³è§£ç å°±åœ¨æœ€ååŠ -u;varLebelä¼šç»™å˜é‡åŠ ä¸Šè§£é‡Š(ä¸å»ºè®®æ·»åŠ ï¼Œä¼šæ”¹å˜å¯¹è±¡æ ¼å¼)

nhs_brief(tsv,"mili")#æŸ¥æ‰¾å‚å†›ç›¸å…³çš„å˜é‡ï¼Œå‘ç°åœ¨åé¢çš„å¹´ä»½å‡ºç°äº†æ–°çš„å˜é‡ådmqmilitå’Œdmqmilizï¼Œå…¶å®æ˜¯ä¸€æ ·çš„,éƒ½æ”¹ä¸ºmiliå˜é‡ã€‚è¯¥å‡½æ•°è¿è¡Œå®Œåä¼šç›´æ¥å¤åˆ¶å˜é‡ååˆ°ç²˜è´´æ¿ï¼Œç›´æ¥åœ¨nhs_readä¸­ç²˜è´´å°±å¯ä»¥äº†
```

3.  å¼ºåŒ–nhs_tsv()å‡½æ•°å¯¹æ•°æ®çš„æå–

åœ¨Rä¸­ï¼Œ.è¡¨ç¤ºä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œ\\.åˆ™è¡¨ç¤ºå•çº¯çš„.è¿™ä¸ªå­—ç¬¦ã€‚\|è¡¨ç¤º"æˆ–è€…"çš„é€»è¾‘å…³ç³», !\~è¡¨ç¤ºä¸åŒ…å«

```{r eval=FALSE}
nhs_tsv('lab10')
nhs_tsv("lab10\\.")#åªæå–lab10.è¿™ä¸ªæ–‡ä»¶

nhs_tsv("lab13am|l13am|trigly")#æå–è¿™ä¸‰ä¸ªæ–‡ä»¶
nhs_tsv("lab13am|l13am|trigly","!~l13am_b|l13am_c")#æå–ä¸‰ä¸ªæ–‡ä»¶ï¼Œä½†ä¸åŒ…å«l13am_bå’Œl13am_c
```

4.  å®éªŒå®¤æ£€æŸ¥æ•°æ®çš„è¯»å–\
    å…ˆå»ç½‘ç«™ä¸Šæ£€ç´¢ï¼Œå¦‚hemoglobinï¼Œç„¶åç¡®å®šæ–‡ä»¶å. nhs_readæ”¯æŒè¿ç»­æ·»åŠ æ•°æ®ï¼Œåªéœ€è¦å…ˆè¾“å…¥æ–‡ä»¶åå†è¾“å…¥å˜é‡ï¼Œå¦‚(cbc, "lbxhgb', demo," riagendr"), å¦‚æœä¸æŒ‡å®šå˜é‡ï¼Œä¼šæŠŠcbcä¸­æ‰€æœ‰çš„å˜é‡å…¨éƒ¨æå–è¿›å»

    ```{r results='hide'}
    library(nhanesR)
    demo <- nhs_tsv("demo")#æå–æ‰€æœ‰äººå£å­¦æ•°æ®

    cbc <- nhs_tsv("lab25|l25|cbc")#è¡€çº¢è›‹ç™½æœ‰ä¸‰ä¸ªä¸åŒçš„æ–‡ä»¶åï¼Œå…¨éƒ¨æå–
    bmx <- nhs_tsv("bmx")#æå–bmiå’Œè…°å›´æ‰€åœ¨çš„æ–‡ä»¶

    x <- nhs_read(demo,"ridageyr:age","riagendr:gender","dmqmilit:mili","dmqmiliz:mili",
                  cbc,"lbxhgb:Hbg",
                  bmx,"bmxbmi:BMI","bmxwaist:Waist",
                  codebook = T)#ç›´æ¥å°†è¡€çº¢è›‹ç™½å’ŒBMIå’Œè…°å›´çš„æ•°æ®æ·»åŠ åˆ°ä¹‹å‰äººå£å­¦æ•°æ®ä¹‹å
    nit1 <- head(x)
    ```

```{r eval=FALSE}
#| echo: false
knitr::kable(nit1,digits = 2,align = "c") %>% 
  kable_styling(full_width = F,position = "center") %>% 
  column_spec(1,bold = T,color='black',background = 'lightblue')
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/20221003094800.png){width="339"}

## 3.æƒé‡

1.æ‰¾åˆ°åˆç†çš„æƒé‡ã€‚2.è®¡ç®—åˆå¹¶æƒé‡ï¼›æƒé‡ä¸éœ€è¦è®¡ç®—ï¼Œnhaneså·²ç»è®¡ç®—å¥½äº†ï¼Œåªéœ€è¦è®¡ç®—[**åˆå¹¶æƒé‡**]{.underline}ã€‚

NHANESä¸­æä¾›äº†å„ç§å„æ ·çš„æƒé‡ï¼Œå¦‚interviewæƒé‡(wtint2yr), mecæµ‹è¯•æƒé‡(wtmec2yr)å’Œä¸€äº›äºšç»„çš„æƒé‡ã€‚ä¸€ä¸ªå¥½çš„ç»éªŒæ³•åˆ™æ˜¯ä½¿ç”¨"æœ€å°å…¬åˆ†æ¯"ï¼Œå…¶ä¸­é’ˆå¯¹[**æœ€å°‘æ•°é‡çš„è®¿è°ˆè€…æ”¶é›†çš„æ„Ÿå…´è¶£å˜é‡**]{.underline}æ˜¯"æœ€å°å…¬åˆ†æ¯"ã€‚é€‚ç”¨äºè¯¥å˜é‡çš„æ ·æœ¬æƒé‡æ˜¯ç”¨äºè¯¥ç‰¹å®šåˆ†æçš„é€‚å½“æƒé‡ã€‚æ‰€æœ‰è®¿è°ˆå’Œmecæµ‹è¯•æƒé‡éƒ½å¯ä»¥åœ¨ç›¸åº”è°ƒæŸ¥å‘¨æœŸçš„äººå£ç»Ÿè®¡æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚æ³¨æ„ï¼šæœ‰äº›é—®å·ç»„ä»¶æ˜¯åœ¨mecä¼šè¯æœŸé—´è€Œéå®¶åº­è®¿è°ˆæœŸé—´ç®¡ç†çš„ï¼Œå› æ­¤å¿…é¡»å¯¹è¿™äº›ç»„ä»¶ä½¿ç”¨mecæµ‹è¯•æƒé‡

### å¦‚ä½•è®¡ç®—åˆå¹¶æƒé‡

wtint2yræŒ‡ä¸¤å¹´çš„ï¼ˆä¸€ä¸ªyear circleï¼‰æƒé‡ï¼Œé€‰æ‹©äº†å‡ ä¸ªyear circleå°±ä¹˜ä»¥å‡ åˆ†ä¹‹1ã€‚åŠåˆå¹¶æƒé‡=å¯¹åº”æƒé‡\*1/nã€‚ä½†å½“[**åŒæ—¶æ¶‰åŠ**åˆ°1999-2000å’Œ2001-2002]{.underline}æ—¶éœ€è¦ç”¨4å¹´æƒé‡**wtint4yr**ï¼Œåˆ†å¼€ä½¿ç”¨åªéœ€è¦2å¹´æƒé‡ã€‚å¦‚æœæ¶‰åŠ1999-2002å’Œå…¶ä»–year circleï¼Œå¦‚2003-2004ï¼Œæ­¤æ—¶6å¹´çš„æƒé‡wt6yr=2/3Ã—wt4yrï¼Œå’Œ1/3Ã—wt2yrã€‚å¦‚æœæ˜¯8å¹´æƒé‡wt8yr=2/4Ã—wt4yrå’Œ1/4Ã—wt2yrï¼Œå¦‚æ­¤ç±»æ¨

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202209281102323.png){width="379"}

### ç¤ºä¾‹å®æ“

#### ç¤ºä¾‹1

nhanes2013-2016ï¼Œç§æ—è¥¿ç­ç‰™è£”è¡€ç»Ÿä»¥åŠè´«å›°ä¸20å²åŠä»¥ä¸Šæˆå¹´äºº[**å…ˆå‰è¯Šæ–­**]{.underline}ä¸ºç³–å°¿ç—…çš„å…³è”ã€‚æ‰€æœ‰çš„å˜é‡éƒ½æ˜¯åœ¨å®¶åº­è®¿è°ˆä¸­æ”¶é›†çš„ã€‚ä½¿ç”¨è®¿è°ˆæƒé‡è¿›è¡Œåˆ†æwtint4yr,æŸ¥è¯¢åˆ°ç§æ—çš„å˜é‡åä¸ºridreth1ï¼Œè´«å›°povertyçš„å˜é‡åä¸ºindfmpirï¼Œå¹´é¾„å˜é‡åä¸ºridageyrï¼›ç³–å°¿ç—…çš„è¯Šæ–­åœ¨Questionnaireé‡Œçš„diq010å˜é‡ã€‚æƒé‡æå–[wtint2yr]{.underline}

```{r include=FALSE}
library(nhanesR)
demo <- nhs_tsv('dem',years = c(1999,2001,2013:2016))#æå–demographicçš„æ•°æ®

diq <- nhs_tsv("diq",years = c(1999,2001,2013:2016))#æå–questionnaireé‡Œçš„æ•°æ®
x <- nhs_read(demo,"ridreth1:eth","indfmpir:poverty","ridageyr:age","wtint2yr",
              "wtint4yr",
                 diq,"diq010:Diabetes")

# x$newwt <- 1/2*x$wtint2yr#ä¸€å…±æœ‰ä¸¤ï¼ˆnï¼‰ä¸ªyear circleï¼Œæ‰€ä»¥åˆå¹¶æƒé‡ä¸º1/2(1/n)*2ywt

ck <- x$Year %in% c("1999-2000","2001-2002")#å½“1999å’Œ2001ä¸¤ä¸ªyear circleåŒæ—¶å‡ºç°æ—¶ï¼Œä»–ä»¬çš„åˆå¹¶æƒé‡ä¸º2/n*wt4yrï¼Œå…¶ä»–çš„å¹´ä»½ä»ç„¶æ˜¯1/n*wt2y
x$newwt <- ifelse(ck,2/4*x$wtint4yr,1/4* x$wtint2yr)#ä¸€å…±4ä¸ªyear circle
```

### æƒé‡æ€»ç»“

-   å®¶åº­é‡‡è®¿æƒé‡interviewï¼ˆèŒƒå›´æœ€å¤§ï¼‰ï¼›wtint2yr/wtint4yr

-   è½¦é‡Œçš„æƒé‡MECï¼ˆmobile examination carï¼‰ï¼ˆèŒƒå›´è¾ƒintå°ï¼‰ï¼›wtmec2yr/wtmec4yr

-   å…¶ä»–æƒé‡ï¼ˆèŒƒå›´æœ€å°ï¼‰ï¼›wtsaf2yrç­‰ï¼ŒèŒƒå›´æœ€å°

    é€‰æ‹©æƒé‡åº”è¯¥é€‰æ‹©æœ€å°æƒé‡ï¼Œå³ä¸åŒæƒé‡çš„äº¤é›†ï¼ˆå³æœ‰ç‰¹æ®Šæƒé‡å°±é€‰ç‰¹æ®Šæƒé‡ï¼Œæ²¡æœ‰å°±é€‰mecæˆ–int

-   åˆå¹¶æƒé‡çš„è®¡ç®—ï¼šyear circleä¸ºnï¼Œåˆå¹¶æƒé‡ä¸º1/n\*2yr; å¦‚æœåŒæ—¶å‡ºç°1999-2000å’Œ2001-2002ï¼Œè¿™ä¸¤ä¸ªcircleçš„åˆå¹¶æƒé‡ä¸º2/nÃ—4yrï¼Œå…¶ä½™çš„circleè¿˜æ˜¯1/nÃ—2yr

## 4.æ•°æ®çš„æ¸…æ´—

-   [**å¦‚ä½•å¿«é€Ÿè¾“å…¥Factor**]{.underline}

    åŸºäºnhanesRåŒ…é‡Œçš„Factorå‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ç”ŸæˆfactoråŒ–çš„ä»£ç 

```{r eval=FALSE}
c <- c("white","black","red","purple")
Factor(c)#è¿è¡Œè¿™è¡Œä¾¿ä¼šè‡ªåŠ¨ç”Ÿæˆä¸‹ä¸€è¡Œçš„å› å­åŒ–çš„ä»£ç 
c <- factor(c, levels = c("white","black","red","purple"))
```

-   [**å¦‚ä½•ä¿®æ”¹å˜é‡åï¼ˆRecodeï¼‰**]{.underline}

```{r eval=FALSE}
c <- c("white","black","red","purple")
# Recode(c)#è¿è¡Œè¿™è¡Œä¾¿ä¼šç”Ÿæˆä¸‹é¢çš„ä»£ç ï¼Œç”¨äºå°†åŸæœ‰çš„å˜é‡æ”¹å
d$eth.new <- Recode(d$eth,
	"Non-Hispanic White::", 
	"Non-Hispanic Black::", 
	"Other Race - Including Multi-Racial::", 
	"Mexican American::", 
	"Other Hispanic::",
	to.numeric = FALSE)
c.new <- Recode(c,
	"white::", 
	"black::", 
	"red::", 
	"purple::",
	to.numeric = FALSE)
```

-   NHSIIIçš„æ•°æ®å¦‚ä½•è®¡ç®—åˆå¹¶æƒé‡ NHSIIIæ˜¯1999å¹´ä»¥å‰çš„æ•°æ®ï¼Œæ˜¯ä»¥3å¹´ä¸ºä¸€ä¸ªå‘¨æœŸã€‚è®¡ç®—æƒé‡æ—¶éœ€è¦ä»¥å¹´æ¥ï¼Œè€Œä¸æ˜¯year circleã€‚ä¾‹å¦‚1994-1996ï¼Œ2001-2002ï¼Œ2009-2010ï¼Œæ­¤æ—¶æ€»å…±3+2+2=7å¹´ï¼Œæ‰€ä»¥1994-1996çš„æƒé‡æ˜¯3/7Ã—wt3yrï¼Œå…¶ä½™çš„æ˜¯2/7Ã—wt2yrã€‚ä½†æ˜¯å¦‚ä½•åŒæ—¶æ¶‰åŠåˆ°1999å’Œ2001æ—¶ï¼Œè¿™ä¸¤ä¸ªyear circleè¦åˆå¹¶ç®—ä½œ4å¹´ï¼Œç”¨wt4yræ¥è®¡ç®—ã€‚

-   [**é€‰æ‹©è¡Œå’Œåˆ—**]{.underline}\
    å¯ä»¥ç”¨nhanesRé‡Œçš„select_rowå‡½æ•°æ¥é€‰æ‹©è¡Œ,drop_rowæ¥åˆ é™¤è¡Œ

```{r eval=FALSE}
d0 <- db_demo(years = 1999:2003,ageyr = "age",sex = T,eth1 = T,Year = T,poverty = T)#ç›´æ¥æå–1999-2003çš„æ‰€æœ‰äººå£å­¦æ•°æ®ï¼ŒæŒ‡å®šéœ€è¦å‡ºç°çš„åˆ—
d1 <- select_row(x,x$Year=="1999-2000" & x$age >= 50)#é€‰æ‹©xä¸­å¹´ä»½ä¸º1999-2000ï¼Œå¹´é¾„å¤§äºç­‰äº50å²çš„æ•°æ®è¡Œ
d1 <- select_row(x,x$Year %in% c("1999-2000","2001-2002"))#åŒæ—¶è®¾ç½®å¤šä¸ªç­›é€‰æ¡ä»¶
d2 <- drop_row(x,x$Year=="2001-2002")#å»é™¤xä¸­å¹´ä»½ä¸º2001-2002çš„æ•°æ®
d3 <- drop_row(d0,is.na(d0$poverty))#ç”¨drop_rowä¹Ÿå¯ä»¥å»é™¤ç¼ºå¤±å€¼
```

#### æ•°æ®çš„åˆå¹¶

ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥ç”¨ç®¡é“æ“ä½œç¬¦æ·»åŠ æ•°æ®

```{r eval=FALSE}
d1 <- db_demo(years = c(1999:2003,2007),Year = T,
              sex = T,ageyr = "age") |> 
  db_cbc(wbc_1000cells.ul = "wbc") |> 
  dex_phenoAge()
#cbcæ˜¯å…¨è¡€ç»†èƒæ•°æ®ï¼ŒphenoAgeæ˜¯ç”Ÿç‰©å­¦å¹´é¾„ï¼Œç›´æ¥ç”¨ç®¡é“æ“ä½œç¬¦å³å¯ä¸æ–­æ·»åŠ æ•°æ®
head(d1)
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210030944349.png){width="426"}

ç¬¬äºŒç§æ–¹æ³•æ˜¯å…ˆåˆ†åˆ«æå–æ•°æ®ï¼Œç„¶åå†åˆå¹¶.æ­¤æ—¶å¯ä»¥**left_join,righ_join,inner_join,full_join**

```{r}
d1 <- db_demo(years = c(1999:2003,2007),Year = T,
              sex = T,ageyr = "age")
d2 <- db_cbc(years = c(1999:2003,2007),wbc_1000cells.ul = "wbc")
d3 <- dex_phenoAge()
d4 <- Left_Join(d1,d2,d3)#left_joinåªåŒ¹é…d1çš„åºå·,å¯ä»¥çœ‹åˆ°d4å’Œd1å…·æœ‰åŒæ ·çš„è¡Œæ•°
d5 <- Right_Join(d1,d2,d3)#å…ˆä¸d2åˆå¹¶ï¼Œå†ä¸d3åˆå¹¶ï¼Œæœ€ç»ˆæ•°æ®ä»¥d3ä¸ºå‡†
d6 <- Inner_Join(d1,d2,d3)#ä»¥ä¸‰è€…å…±æœ‰çš„æ•°æ®ä¸ºå‡†è¿›è¡Œåˆå¹¶
d7 <- Full_Join(d1,d2,d3)#æ‰€æœ‰çš„æ•°æ®ä¸€èµ·åˆå¹¶

d8 <- Left_Join(d2,d1) #ä¼šæ˜¾ç¤ºd1äººå£å­¦æ•°æ®ä¸­æœ‰4028äººæ²¡æœ‰ç™½ç»†èƒè®¡æ•°çš„æ•°æ®ï¼Œä¾¿äºç”»æµç¨‹å›¾
# d2   :37247 ; d1:41275(-4028) 
d8 <- Left_Join(d2,d1,inspect = c("age","sex")) #å¯ä»¥æŸ¥çœ‹æŸä¸ªå˜é‡åœ¨d1åˆå¹¶åˆ°d2å‰åçš„å˜åŒ–ï¼Œç»¿è‰²è¡¨ç¤ºå‡å°‘ï¼Œçº¢è‰²è¡¨ç¤ºå¢å¤š
#å…¶ä»–ç±»å‹çš„joinä¹Ÿå¯ä»¥inspect
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/20221003101606.png){width="295"}

#### æ·»åŠ æ–°åˆ—

1.æ·»åŠ æ–°åˆ—çš„ä¸»è¦ä½œç”¨ä¸ºå¯¹åŸå§‹æ•°æ®çš„æŸäº›å€¼è¿›è¡Œåˆ¤æ–­ï¼Œå¢åŠ ä¸€äº›æ–°çš„å˜é‡ï¼Œä¾‹å¦‚æ˜¯å¦æ˜¯è€å¹´ï¼ŒæŸäº›æŒ‡æ ‡æ˜¯å¦å‡é«˜ç­‰ã€‚

```{r}
d <- db_demo(years = 1999,ageyr = "age",sex = T,Year = T) |> 
  db_cbc(wbc_1000cells.ul = "wbc")
d <- drop_row(d,is.na(d$wbc))#å»é™¤ç™½ç»†èƒè®¡æ•°çš„ç¼ºå¤±å€¼
####ä»¥10ä¸ºç•Œå€¼ï¼Œåˆ¤æ–­ç™½ç»†èƒæ•°æ˜¯å¦å‡é«˜####
d <- add_col(d,colname = "wbc_level",value = "yes",condition = d$wbc > 10) |> 
  add_col(colname = "wbc_level",value = "no",condition = d$wbc <= 10)#æ–°å¢ä¸€åˆ—ï¼Œåˆ—åä¸ºwbc_levelï¼Œç™½ç»†èƒå¤§äº10çš„æ—¶å€™ä¸ºyesï¼Œå°äºç­‰äº10çš„æ—¶å€™ä¸ºno

####å¯¹äºç™½ç»†èƒï¼Œç”·æ€§çš„ç•Œé™ä¸º10ï¼Œå¥³æ€§çš„ç•Œé™æ˜¯9####
ck <- (d$sex == "Male" & d$wbc > 10) | (d$sex == "Female" & d$wbc >10)

d1 <- add_col(d,colname = "wbc_level",value = "yes",condition = ck) |> 
  add_col(colname = "wbc_level",value = "no",condition = is.na(d1$wbc_level),
          position = 2)
#å…ˆæŠŠç”·æ€§å’Œå¥³æ€§çš„yesæŒ‡å®šäº†ï¼Œç„¶åå‰©ä¸‹çš„NAå…¨éƒ¨æ˜¯noã€‚positionå¯ä»¥æŒ‡å®šæ–°å¢çš„åˆ—çš„ä½ç½®
```

2.ä¹Ÿå¯ä»¥ç”¨äºä¸€äº›ç–¾ç—…çš„è¯Šæ–­çš„æ·»åŠ ï¼Œä¾‹å¦‚ç¡çœ å‘¼å¸æš‚åœç»¼åˆå¾ğŸ‘‡

```{r}
d <- db_slq(years = 2005,
            sleep_disorder_sleep_apnea = "apnea",
            how_often_do_you_snort_or_stop_breathing = "stop_breathing",
            how_often_feel_overly_sleepy_during_day = "sleepy")#æå–ç¡çœ å‘¼å¸æš‚åœç›¸å…³çš„æ•°æ®
#å°†åŸæ¥çš„å˜é‡å€¼è¿›è¡Œé‡ç¼–ç ğŸ‘‡
# Recode(d$apnea) 
d$apnea <- Recode(d$apnea,
	"sleep apnea::yes", 
	"NA::",
	to.numeric = FALSE)
# Recode(d$stop_breathing)
d$stop_breathing <- Recode(d$stop_breathing,
	"never::no", 
	"frequently (5 or more nights/week)::yes", 
	"rarely (1-2 nights/week)::no", 
	"occasionally (3-4 nights/week)::yes", 
	"NA::",
	to.numeric = FALSE)
# Recode(d$sleepy)
d$sleepy <- Recode(d$sleepy,
	"rarely (1 time a month)::no", 
	"never::no", 
	"almost always (16-30 times a month)::yes", 
	"sometimes (2-4 times a month)::yes", 
	"often (5-15 times a month)::yes", 
	"NA::",
	to.numeric = FALSE)
d$osas <- paste0(d$apnea,"~",d$stop_breathing,"~",d$sleepy)#å°†ä¸‰ä¸ªæŒ‡æ ‡åˆå¹¶åœ¨ä¸€èµ·
# Recode(d$osas) #å¼€å§‹ç­›é€‰è¯Šæ–­æ ‡å‡†ï¼Œä¸‰ä¸ªä¸­ä»»æ„ä¸€ä¸ªä¸ºyeså°±å¯ä»¥è¯Šæ–­ä¸ºOSAS
d$osas <- Recode(d$osas,
	"NA~no~no::no", 
	"NA~no~yes::yes", 
	"yes~no~no::yes", 
	"yes~NA~yes::yes", 
	"NA~yes~no::yes", 
	"NA~NA~yes::yes", 
	"yes~yes~yes::yes", 
	"NA~yes~yes::yes", 
	"NA~NA~no::no", 
	"NA~no~NA::no", 
	"yes~no~yes::yes", 
	"yes~yes~no::yes", 
	"NA~NA~NA::NA", 
	"yes~NA~no::yes",
	to.numeric = FALSE)
```

3.ä¹Ÿå¯ä»¥ç”¨äºæŸç§æ¡ä»¶ä¸‹è¿›è¡Œåˆ†ç»„. quantå¯ä»¥æ‰§è¡Œåˆ†ä½æ•°çš„è®¡ç®—

```{r}
d <- db_demo(years = 1999,sex = "sex",ageyr = "age",psu_strat = F) |> 
  db_cbc(wbc_1000cells.ul = "wbc")
d <- drop_row(d,is.na(d$wbc))
#æ ¹æ®ç™½ç»†èƒçš„å‡å€¼åˆ†ä¸º2ç»„
d <- add_col(d,"wbc2","high",d$wbc > mean(d$wbc)) |> 
  add_col("wbc2","low",d$wbc <= mean(d$wbc))

#å°†ç™½ç»†èƒæŒ‰ç…§å››åˆ†ä½æ•°åˆ†æˆ4ç»„ï¼Œå¹¶ä¸”ç¼–ç ä¸ºQ1ï¼ŒQ2ï¼ŒQ3ï¼ŒQ4
# quant(d$wbc)
d$wbcQ <- quant(d$wbc, n = 4,Q = TRUE,round=3)#n=4å³è¿›è¡Œå››åˆ†ä½æ•°è®¡ç®—
d$wbcQ.median <- quant.median(d$wbc, n = 4,round=3)#è®¡ç®—æ¯ä¸ªå››åˆ†ä½é—´è·çš„ä¸­ä½æ•°
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/20221003161242.png){width="441"}

## 5.æ•°æ®æå–æ±‡æ€»

æå–çš„æ•°æ®å¯ä»¥è¿›è¡Œå åŠ ï¼Œä¾‹å¦‚db_demo() \|\> db_drtot()å¯ä»¥ä¸æ–­å¢åŠ ä¸åŒç±»å‹çš„æ•°æ®

### æå–äººå£å­¦æ•°æ®

ä½¿ç”¨db_demo(),éœ€è¦çš„åˆ—å°±æŒ‡å®šä¸ºTRUE

### æå–é¥®é£Ÿæ•°æ®

ä½¿ç”¨**db_drtot()**, day= å¯ä»¥æŒ‡å®šæ˜¯ä¸€å¤©çš„é¥®é£Ÿæ•°æ®è¿˜æ˜¯ä¸¤å¤©çš„é¥®é£Ÿæ•°æ®ï¼Œé»˜è®¤æ˜¯2å¤©çš„æ•°æ®ã€‚fun= å¯ä»¥è®¡ç®—meanã€sumã€aloneï¼ˆ2å¤©çš„éƒ½åˆ†å¼€æ˜¾ç¤ºï¼‰ï¼Œé»˜è®¤æ˜¯sumã€‚both2daysè¡¨ç¤ºæ˜¯å¦åªè¦2å¤©éƒ½æœ‰çš„æ•°æ®ï¼Œé»˜è®¤ä¸ºTRUE

```{r}
x <- db_drtot(years = 2005,calcium_mg = T,Year = T,fun = "alone")
head(x)#aloneæ˜¾ç¤º2å¤©çš„æ•°æ®
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210031742905.png){width="447"}

å¦‚æœboth2daysä¸ºFALSEï¼Œåˆ™ä»…1å¤©æœ‰æ•°æ®çš„è¡Œä¹Ÿä¼šæ˜¾ç¤º

```{r}
x <- db_drtot(years = 2005,calcium_mg = T,Year = T,both2days = F,fun = "alone")
head(x)
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210031745536.png){width="445"}

### æå–ç”Ÿå­˜æ•°æ®

db_mort()ç”¨äºæå–ç”Ÿå­˜æ•°æ®ï¼Œç”Ÿå­˜æ•°æ®ä¸»è¦åŒ…æ‹¬7åˆ—ã€‚

```{r}
mort <- db_demo(years = 2005,ageyr = "age",sex = "sex",psu_strat = F) |> 
  db_mort(years = 2005) #å…ˆäººå£å­¦æ•°æ®ï¼Œç„¶åæ·»åŠ ä¸Šç”Ÿå­˜æ•°æ®
```

### æå–é¥®é…’ç›¸å…³æ•°æ®

1.æå–g/day

```{r}
db_drtot(years=2005,alcohol_g = "alcohol",day = c(1,2),fun = "mean", both2days = F)
```

2.æå–drink/dayçš„æ•°æ®.æ³¨æ„ä¸æ˜¯cup/day

```{r}
d <- db_fped(a_drinks = T,years = 2005)
d1 <- db_Alcohol.drinks(years = 2005)#è¿™ä¸ªæ˜¯æœ€å‡†ç¡®çš„ï¼Œdrinks/day
```

3.é…’ç²¾ä½¿ç”¨ç¨‹åº¦åˆ†ç±»

-   current heavey alcohol use\
    â‰¥3 drinks perday for female\
    â‰¥4 for male\
    binge drinking on 5 or more days per month

-   current moderate alcohol use\
    â‰¥2 drinks per day for female\
    â‰¥3 for male\
    binge drinking â‰¥ 2days per month

-   current mild alcohol use\
    not meet the above

```{r}
t <- diag_alcohol.user(years = 2005,binge = T,Year = T)#å¯ä»¥ä¿®æ”¹mild,moderateï¼Œheaveyçš„åˆ¤æ–­æ ‡å‡†ï¼Œå¯ä»¥è®¾å®šæ˜¯å¦æœ‰bingeè¿™ä¸ªç¨‹åº¦
```

### é»„é…®ç±»åŒ–åˆç‰©æ•°æ®æå–

é»„é…®ç±»åŒ–åˆç‰©æ•°æ®åº“Flavonoidã€‚ä¹‹å‰åªæœ‰2007-2010çš„æ•°æ®ï¼Œ2022å¹´å¤å¤©å‡ºäº†2017-2018çš„æ•°æ®ã€‚åŒ…å«6ç§é»„é…®ç±»çš„29ç§åŒ–åˆç‰©çš„é¥®é£Ÿæ‘„å…¥æ•°æ®ã€‚dayè¡¨ç¤ºæå–1å¤©è¿˜æ˜¯ä¸¤å¤©çš„æ•°æ®ï¼Œè¦ä¹ˆç¬¬ä¸€å¤©ï¼Œè¦ä¹ˆä¸¤å¤©åŒæ—¶ä½¿ç”¨ï¼›å½“ä½¿ç”¨ä¸¤å¤©æ—¶ï¼Œfunå¯ä»¥æŒ‡å®šè®¡ç®—å‡å€¼ï¼ˆmeanï¼‰è¿˜æ˜¯å’Œï¼ˆsumï¼‰ï¼›

```{r}
fl <- db_flavonoids(Daidzein_mg = "Daidzein")
```

### é‡é‡‘å±æ•°æ®æå–

ä»pbcdæ•°æ®ä¸­æå–é‡é‡‘å±ç›¸å…³çš„æ•°æ®ï¼Œä½¿ç”¨db_PbCd()æå–ï¼Œæ•°æ®ä»2005å¹´å¼€å§‹ï¼Œå¦‚é“¬ã€æ±ã€é”°ç­‰é‡é‡‘å±ã€‚æ³¨æ„ï¼šå½“ä½¿ç”¨PbCdæ•°æ®æ—¶ï¼Œ2013-2014å’Œ2015-2016ä¸¤å¹´ï¼Œéœ€è¦ä½¿ç”¨wtsh2yræƒé‡ï¼Œå› ä¸ºè¿™ä¸¤å¹´12å²ä»¥ä¸Šçš„å‚ä¸è€…åªæœ‰1/2çš„æ ·æœ¬è¿›è¡Œäº†æ£€æµ‹ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå•ç‹¬çš„wtsh2yrï¼Œè€Œ1-11å²çš„wtsh2yrç­‰åŒäºMECæƒé‡ã€‚æ‰€ä»¥æ¶‰åŠè¿™ä¸¤ä¸ªyear circleæ—¶ä½¿ç”¨ç‰¹æ®Šæƒé‡wtsh2yrï¼Œå…¶ä½™çš„circleä½¿ç”¨MECæƒé‡ã€‚dp_PbCd()ä¸­æä¾›äº†æƒé‡weight = Tå³å¯è‡ªåŠ¨æä¾›æƒé‡(ä»…åŸå§‹æƒé‡ï¼Œåˆå¹¶æƒé‡æŒ‰åŸæ–¹æ³•è®¡ç®—ï¼‰

```{r}
x <- db_PbCd(years = 2013,blood_cadmium_ug.l = T,weight = T) |> 
  drop_row(is.na(x$blood_cadmium_ug.l))
```

### è¯ç‰©æœç´¢ä¸æå–

å…ˆæ£€ç´¢ï¼Œçœ‹æ˜¯ä¸æ˜¯è‡ªå·±æƒ³è¦çš„è¯ç‰©ï¼Œå†Drug()å»æå–ã€‚remove.otherå¦‚æœæ˜¯Fï¼Œåˆ™å¦‚æœä¸€ä¸ªäººæ—¢åƒäº†æ£€ç´¢çš„è¯ç‰©ï¼Œåˆåƒäº†å…¶ä»–è¯ï¼Œå°±ä¼šå å¤šè¡Œã€‚å¦‚æœ=Tï¼Œåˆ™ä¼šå€¼ä¿ç•™æ£€ç´¢çš„è¯ç‰©ï¼ˆä»…åˆ é™¤åŒæ—¶å‡ºç°çš„æƒ…å†µï¼‰ã€‚

```{r}
browse_rxq_Drug()
browse_rxq_Rx()#å¤„æ–¹æ–‡ä»¶
drug_search("antibiotic",years = 2015)#æ£€ç´¢åŒ…å«å…³é”®è¯antibioticçš„è¯ç‰©
d <- Drug("antibiotic",years = 2015,drugname = T,remove.other = T)#æå–å…³é”®è¯çš„è¯ç‰©

x <- drug_anti.infectives(years = 2015,drugname = T,dcn = T)#æå–æŠ—æ„ŸæŸ“è¯ç‰©
```

## 6.æŒ‡æ ‡è®¡ç®—æ±‡æ€»

### å¥åº·é¥®é£ŸæŒ‡æ•°ï¼ˆHealthy eating indexï¼‰

[å¥åº·é¥®é£ŸæŒ‡æ•°çš„ä»‹ç»](https://epi.grants.cancer.gov/hei/)ã€‚HEIæœ‰ä¸¤ä¸ªç‰ˆæœ¬2015å’Œ2010ï¼Œ2015æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä»¥ç¬¦åˆ2015-2020ç¾å›½äººè†³é£ŸæŒ‡å—ã€‚ç®—æ³•åŒ…æ‹¬ç®€å•ç®—æ³•å’Œpopulation ratio methodï¼Œç®€å•ç®—æ³•åˆåŒ…æ‹¬Per dayå’ŒPer personï¼Œper dayå°±æ˜¯åœ¨day = 1ï¼ŒPer personå°±æ˜¯day=c(1,2), å¯¹åº”method = "ssum"å’Œ"partio".é»˜è®¤ä¼šç»™æ‰€æœ‰æˆåˆ†çš„è¯„åˆ†ï¼Œå¦‚æœcomponent = Få°±åªç»™total score

```{r}
x <- dex_HEI(years = 2011,version = 2015,method = "ssum",day = 1,dietary = "tot")
```

### å’–å•¡æ•°æ®æå–

db_coffee(). å’–å•¡æ•°æ®æœ€å¥½æ˜¯åœ¨1999å¹´ä»¥åè¿›è¡Œã€‚åŒ…å«äº†æ˜¯å¦æ·»åŠ å’–å•¡å› ï¼Œæ˜¯å¦åŠ ç³–ï¼Œæ˜¯å¦åŠ è„‚ï¼ŒåŠ å¥¶ç­‰ï¼Œä»¥åŠå’–å•¡çš„ç§ç±»ï¼Œå¦‚å¡å¸ƒå¥‡è¯ºã€æ‘©å¡ã€ç›å¥‡æœµç­‰ç­‰ã€‚ å¦‚ä½•ç¡®å®šå¹¶è¯†åˆ«å’–å•¡æ•°æ®ï¼Ÿ--ä½¿ç”¨çš„æ˜¯FNDDsæ•°æ®é‡Œçš„é£Ÿç‰©ç¼–ç 921å¼€å¤´çš„æ˜¯coffeeï¼ˆç”¨äºå†™æ–‡ç« è¯´æ˜æ•°æ®æ¥æºï¼‰ å’–å•¡æ‘„å…¥çš„å…‹æ•°è½¬åŒ–ä¸ºæ¯æ•°ï¼Ÿ--ä»¥6ç›å¸ä¸ºä¸€æ¯

```{r}
co <- db_coffee(years = 2003,
                day = c(1,2), #è¦ä¹ˆæå–ç¬¬ä¸€å¤©ï¼Œè¦ä¹ˆæå–ä¸¤å¤©çš„
                fun = "mean", #é»˜è®¤å–ä¸¤å¤©çš„å‡å€¼
                unit = "g") #gæˆ–è€…cupå•ä½ï¼Œé»˜è®¤æ˜¯g
```

### é¥®é£Ÿç‚ç—‡æŒ‡æ•°çš„æå–

```{r}
di <- dex_DII(years = 2005)
```

### è‚¾å°çƒæ»¤è¿‡ç‡eGFR

dex_eGFR()é‡Œæä¾›äº†10ç§è®¡ç®—eGFRçš„æ–¹æ³•ï¼Œå¦‚Cockcroft_Gault,CKD_EPI_Scr,Schwartzç­‰ç­‰ï¼Œå¯ä»¥åœ¨mothod=é‡Œé™å®šï¼Œé»˜è®¤æ˜¯CKD_EPI_Scrã€‚å¦‚æœéœ€è¦è®¡ç®—å¤šç§æ–¹æ³•çš„eGFRï¼Œåªéœ€è¦method = c(,)ã€‚ç†è®ºä¸Šæ¥è¯´æ¨èä½¿ç”¨è¡€è‚Œé…è®¡ç®—æ»¤è¿‡ç‡ï¼Œæ–¹æ³•æœ€æ¨èMDRDå’ŒCGæ–¹æ³•

```{r}
egf <- dex_eGFR(years = 2005,method = c("CKD_EPI_Scr","BIS1_Scr"))
```

### ç›Šç”Ÿå…ƒã€ç›Šç”ŸèŒã€åˆç”Ÿå…ƒ

[ç›¸å…³å‚è€ƒæ–‡çŒ®](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/PIIS0016508521006612.pdf)ã€‚FDAä¸ç›‘ç®¡ç›Šç”ŸèŒï¼Œä½†æ˜¯ç›‘ç®¡ç›Šç”Ÿå…ƒï¼ˆå¦‚ä¹³æœç³–ï¼‰ï¼Œæ‰€ä»¥å¦‚æœåªç ”ç©¶ç›Šç”ŸèŒï¼Œåªéœ€è¦æ£€ç´¢è†³é£Ÿè¡¥å……å‰‚çš„æ•°æ®ï¼Œè€Œç›Šç”Ÿå…ƒçš„è¯éœ€è¦æ£€ç´¢è¯å“ï¼Œé€šè¿‡å…³é”®è¯æ¥åŒ¹é…æ˜¯å¦å«æœ‰ç›Šç”Ÿå…ƒæˆåˆ†ã€‚

```{r}
pr <- DSD(years = 2016,probiotic = T)
```

## 7.ç–¾ç—…è¯Šæ–­æ±‡æ€»

### ä»£è°¢ç»¼åˆå¾

ä½¿ç”¨diag_MetS() ï¼Œä»£è°¢ç»¼åˆå¾æœ‰ä¸¤ç§è®¡ç®—æ–¹æ³•ï¼Œä¸€ç§æ˜¯ATPï¼ˆç¾å›½çš„ï¼‰å’ŒIDFï¼ˆå›½é™…çš„ï¼‰ã€‚ä¸åŒå¹´é¾„çš„è®¡ç®—å…¬å¼ä¸åŒï¼Œchildren and adolescentæœ‰å•ç‹¬çš„ä¸€å¥—æ ‡å‡†ï¼ˆmodified ATPå’ŒIDFï¼‰ã€‚é»˜è®¤ä½¿ç”¨ATPæ ‡å‡†ã€‚å°†åˆ†åˆ«è®¡ç®—\>=16å²å’Œ10-16å²çš„è¯Šæ–­ç»“æœ

```{r}
x <- diag_MetS(years = 2015)
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210042049416.png){width="285"}

### é«˜è¡€å‹

diag_Hypertension().

å…·ä½“çš„é«˜è¡€å‹è¯Šæ–­æ ‡å‡†ï¼šä»»æ„ä¸€ä¸ªæ»¡è¶³

1.  æ˜¯å¦ä½¿ç”¨é«˜è¡€å‹è¯ç‰©
2.  doctor told you or take drug
3.  bpxè¡€å‹æµ‹é‡ã€‚åˆ†ä¸ºmeanå’Œtimesï¼Œåœ¨method = é‡Œè®¾å®š

```{r}
h <- diag_Hypertension(years = 2015,systolic = 140,diastolic = 90,n=3) #è®¾å®šèˆ’å¼ å‹å’Œæ”¶ç¼©å‹é˜ˆå€¼
h <- diag_Hypertension(years = 2015,method = "mean") #ä½¿ç”¨å‡å€¼æ¥è¯Šæ–­
h <- diag_Hypertension(years = 2015,method = "times",n=3) #ä½¿ç”¨3æ¬¡æµ‹é‡æ¥åˆ¤æ–­æ˜¯å¦æ‚£æœ‰é«˜è¡€å‹
```

### é«˜è„‚è¡€ç—‡

åŒ…å—é«˜ç”˜æ²¹ä¸‰é…¯è¡€ç—‡ã€é«˜èƒ†å›ºé†‡è¡€ç—‡ã€å’Œä½¿ç”¨é™è„‚è¯

```{r}
d <- diag_Hyperlipidemia(years = 2015)
```

### ç³–å°¿ç—…

ç³–å°¿ç—…è¯Šæ–­æ ‡å‡†

1.  doctor told you have DM
2.  res_HbA1cï¼šç³–åŒ–è¡€çº¢è›‹ç™½
3.  fast glucoseï¼šç©ºè…¹è¡€ç³–ã€‚IFGä¸ºç©ºè…¹è¡€ç³–å—æŸ
4.  glucoseéšæœºè¡€ç³–å€¼
5.  OGTT2å°æ—¶ï¼ŒIGTä¸ºç³–è€é‡å—æŸ
6.  drug useï¼šantidiabetic å¦‚æœä½¿ç”¨äº†å®éªŒå®¤æ£€æŸ¥ï¼ˆ2\~5æ¡ï¼‰ä½œä¸ºè¯Šæ–­æ ‡å‡†ï¼Œåˆ™éœ€è¦ä½¿ç”¨å®éªŒå®¤çš„æƒé‡ï¼Œå¯èƒ½ä¼šä¸§å¤±ä¸€äº›æ•°æ®ï¼Œè¿™æ—¶å€™å¦‚æœä»…ä»…æŠŠç³–å°¿ç—…ä½œä¸ºåå˜é‡æ¥ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥åªç”¨æŠ¥é“çš„ï¼ˆ1å’Œ6æ¡ï¼‰ï¼ŒæŠŠå…¶ä»–çš„å˜é‡éƒ½è®¾ç½®ä¸ºFALSEå³å¯

```{r}
d <- diag_DM(years = 2015,HbA1c = F,fast_glu = F,OGTT2 = F,rand_glu = F)#å°†å®éªŒå®¤ç»“æœä¸ä½œä¸ºè¯Šæ–­æŒ‡æ ‡

```

### å¸çƒŸ

åˆ†ä¸ºä¸‰ç§å¸çƒŸçš„ç±»å‹

1.  neverï¼šsmoked less than 100 cigarettes in life
2.  formerï¼šsmoked more than 100 cigarettes in life and smoke not at all now
3.  nowï¼šsmoked more than 100 cigarettes in life and smoke some days or every day

```{r}
s <- diag_smoke(years = 2015,smoking_years = F)
```

### æŠ‘éƒ

ä½¿ç”¨PHQ-9æŠ‘éƒç­›æŸ¥é‡è¡¨

```{r}
x <- diag_PHQ9(years = 2015,cut = c(10,20))
```

### CKD

è¯Šæ–­æ ‡å‡†é‡‡ç”¨2021å¹´çš„KDIGOï¼Œæœ‰ä¸¤ç§æ ‡å‡†ï¼ŒeGFRå’Œå°¿ç™½è›‹ç™½ã€‚ä¸¤è€…ç»“åˆå¯ä»¥åˆ¤æ–­é¢„åã€‚å¦‚æœéœ€è¦é‡‡ç”¨ç™½è›‹ç™½çš„æ•°æ®ï¼Œéœ€è¦æ˜¯2005å¹´ä»¥åçš„æ‰è¡Œã€‚ckd = ä¸ºCKDçš„æœ€å°è¯Šæ–­æ ‡å‡†ï¼Œé»˜è®¤ä¸ºè¾¾åˆ°A2å’ŒG3aï¼Œå¯ä»¥è‡ªå·±è°ƒæ•´

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210042157840.png){width="363"}

```{r}
e <- diag_CKD(years = 2015,ckd = c("A2","G3a"),
              show_prognosis = T,eGFR_method = "CKD_EPI_Scr")#é»˜è®¤çš„eGFRçš„è®¡ç®—æ–¹æ³•
```

### MAFLDä»£è°¢åŠŸèƒ½éšœç¢ç›¸å…³è„‚è‚ªæ€§è‚ç—…

NAFLDä¸MAFLDï¼Œ2020å¹´å·²ç»å°†NAFLDå»ºè®®è§„çº³å…¥MAFLDä¸­ã€‚NAFLDéœ€è¦æ’é™¤è¿‡é‡é¥®é…’å’Œå…¶ä»–åŸå› çš„è‚è„ç–¾ç—…ï¼ŒMAFLDçš„è¯Šæ–­åˆ™æ˜¯åŸºäºè¶…é‡/è‚¥èƒ–æˆ–T2DMäº¦æˆ–å­˜åœ¨ä¸¤ä¸ªåŠä»¥ä¸Šä»£è°¢å¿ƒè¡€ç®¡å±é™©å› ç´ ã€‚"MAFLD"è¿™ä¸€å‘½åå¼ºè°ƒäº†[**è‚¥èƒ–ã€èƒ°å²›ç´ æŠµæŠ—ã€è¡€è„‚å¼‚å¸¸ã€T2DMå’Œç³»ç»Ÿæ€§å…¨èº«ä½åº¦ç‚ç—‡ååº”**]{.underline}åœ¨è„‚è‚ªæ€§è‚ç—…å‘ç”Ÿå‘å±•ä¸­çš„é‡è¦ä½œç”¨ã€‚å› æ­¤ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„æ ‡å‡†å’Œå®šä¹‰é‡æ–°å¯¹è„‚è‚ªæ€§è‚ç—…è¿›è¡Œä¸´åºŠåˆ†ç±»ã€‚å°½ç®¡å¤§å¤šæ•°æ‚£è€…åŒæ—¶ç¬¦åˆMAFLDä¸NAFLDçš„è¯Šæ–­æ ‡å‡† (MAFLD+NAFLD+)ï¼Œä½†æ˜¯ä»æœ‰éƒ¨åˆ†æ‚£è€…ä»…ç¬¦åˆNAFLDè¯Šæ–­æ ‡å‡†(MAFLD-NAFLD+) æˆ–ä»…ç¬¦åˆMAFLDè¯Šæ–­æ ‡å‡†(MAFLD+NAFLD-)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„NAFLDéƒ½å¯ä»¥ç›´æ¥å½’ç±»ä¸ºMAFLDï¼Œåä¹‹äº¦ç„¶ã€‚

MAFLDçš„è¯Šæ–­æ ‡å‡†ï¼š[å‚è€ƒæ–‡çŒ®.pdf](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/nss-13-103.pdf)

1.  ä¸»è¦æ ‡å‡†ï¼šSteatosisï¼ˆå¿…é¡»æœ‰è‚è„‚è‚ªå˜çš„è¯æ®ï¼‰ï¼šç”¨çš„è¶…å£°CAPè¡°å‡æŒ‡æ•°
2.  æ¬¡è¦æ ‡å‡†ï¼šæ»¡è¶³ä»»æ„ä¸€ä¸ª
    1.  BMIï¼š\>25

    2.  DM

    3.  metabolic dysfunction: 6ä¸ªæŒ‡æ ‡ï¼ˆwaistï¼Œhypertensionï¼Œhyperlipidemiaï¼Œlow HDL-C levelï¼Œprediabetesï¼ˆç©ºè…¹è¡€ç³–å—æŸå’Œç³–è€é‡å—æŸï¼‰ï¼Œhypersensitive C-reactive protein level\>2mg/L

```{r}
d <- diag_MAFLD(years = 2015)#å…¶ä½™å‚æ•°å¯ä»¥æŒ‡å®šæ˜¯å¦è¿”å›è¯Šæ–­æ¡ä»¶çš„ç»“æœ
```

## 8.FPEDæ•°æ®åº“

Food pattern equivalent databaseï¼šé£Ÿç‰©æ¨¡å¼ç­‰é‡æ•°æ®åº“ï¼›å°†NHANESä¸­çš„é£Ÿç‰©å’Œé¥®æ–™è½¬åŒ–ä¸º37ç§USDAé£Ÿç‰©æ¨¡å¼ç»„åˆ†ã€‚ä¸»è¦åŒ…å«9ç±»ï¼šFruit(cup), vegetables(cup), grains(oz), dairy(cup), protein food(oz), added sugars(tsp), oils(grams), solid fats(grams), alcoholic drinks(no.)

å®é™…æ˜¯NHANESçš„iffç»“åˆFNDDså¾—å‡ºçš„ç»“æœï¼Œæ‰€ä»¥åŒæ ·åŒ…å«ä¸¤å¤©çš„æ•°æ®ã€‚1999-2002åªæœ‰1å¤©çš„æ•°æ®ã€‚æƒé‡æœ‰å„è‡ªçš„æƒé‡

![æ•°æ®æå–é€‰é¡¹ï¼Œå¦‚æœé€‰æ‹©both2day=Tï¼Œé‚£ä¹ˆåªæœ‰ä¸¤å¤©å‡æœ‰æ•°æ®æ—¶æ‰ä¼šä¿ç•™](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210051108837.png){width="426"}

-   iffå’Œtotçš„åŒºåˆ«ï¼šä¸¤è€…å‡ä¸åŒ…æ‹¬ä»è†³é£Ÿè¡¥å……å‰‚ã€è¯ç‰©æˆ–æ™®é€šé¥®ç”¨æ°´ä¸­æ‘„å–çš„è¥å…»\
    totæ˜¯Total Nutrient Intakes: åŒ…æ‹¬æ¯å¤©ä»é£Ÿç‰©å’Œé¥®æ–™ä¸­æ‘„å…¥çš„æ€»è¥å…»ï¼Œæ‘„å…¥çš„æ€»æ°´é‡\
    iffæ˜¯Individual Foods Filesï¼šåŒ…æ‹¬å•ä¸ªé£Ÿç‰©çš„ç±»å‹å’Œæ•°é‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œä»¥åŠæ¯ç§é£Ÿç‰©çš„è¥å…»å«é‡\
    2003å¹´ä»¥åæ‰ä¼šæœ‰2å¤©çš„æ•°æ®

### Fruit

fruitåˆ†ä¸ºintact/cut fruit, juice, totalã€‚Citrus, Melons and Berries; Other Fruits; Fruit juice

```{r}
d <- db_fped(years = 2005,dietary = "tot",day = 1,
             f_whole = T,f_citmlb = T,f_other = T,f_juice = T,f_total = T)
#citmlb,other,wholeéƒ½æ˜¯æ•´æœï¼ˆintact/cut fruit), whole=citmlb+other
```

### Vegetables

è”¬èœåˆ†ä¸º6ç±»ï¼š

-   dark greenï¼šv_drkgr

-   red orange: v_redor_tomato,v_redor_other, v_redor_total

-   starchy: v_starchy_potato, v_starchy_other, v_starchy_total

-   other: v_other

-   total: v_totalï¼ˆä¸åŒ…æ‹¬legumesï¼‰

-   legumes: v_legumes

```{r}
d <- db_fped(years = 2015,v_drkgr = T) #ä»¥v_å¼€å¤´
```

### Grains

åŒ…æ‹¬æ•´è°·ç‰©ï¼ˆg_whole), refined or non-whole grainsï¼ˆg_refinedï¼‰, å’Œg_total, å•ä½æ˜¯ç›å¸oz

```{r}
g <- db_fped(years = 2015,g_whole = T)
```

### Dairy

ä¹³åˆ¶å“å•ä½æ˜¯cupã€‚åŒ…æ‹¬d_milk, d_yogurt, d_cheese, d_total

### Protein foods

è›‹ç™½è´¨ç±»ï¼Œå•ä½æ˜¯ç›å¸ã€‚

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210051329370.png){width="478"}\
ä¸»è¦åˆ†ä¸ºæ¤ç‰©è›‹ç™½ã€è‚‰ç±»ã€é¸¡è›‹ã€‚è‚‰ç±»åˆåˆ†ä¸ºè…Œè‚‰ã€ç”Ÿè‚‰ã€å†…è„ã€å¹¼ç¦½ã€æµ·äº§å“ï¼ˆé«˜ä½n-3è„‚è‚ªé…¸ï¼‰ï¼›æ¤ç‰©è›‹ç™½åŒ…æ‹¬è±†åˆ¶å“ï¼Œåšæœç±»ï¼Œè±†ç±»

```{r}
d <- db_fped(years = 2005,pf_curedmeat = T)
```

### Others

-   add sugars(tsp): æ·»åŠ ç³–----- add_sugars

-   Oils(gram): oils

-   Solid fat(grams)ï¼šå›ºæ€è„‚è‚ª solid_fat

-   alcoholic drinks(no.): a_drinks; alcoholic beverage

## 9.æ˜“ä¾•

-   å¦‚ä½•å°†nhanesRçš„æ•°æ®ç›´æ¥å†™å…¥åˆ°æ˜“ä¾•ä¸­\
    å…ˆæ•´ç†å¥½æ•°æ®ï¼Œç„¶åä½¿ç”¨write.yier(), æŒ‡å®šå¯¼å‡ºçš„dfï¼Œå¯ä»¥ä¿®æ”¹fileçš„åå­—å’Œprojectçš„åå­—ã€‚ç„¶åå°±ä¼šåœ¨æ˜“ä¾•çš„Analysisæ–‡ä»¶ä¸‹ç”Ÿæˆä¸€ä¸ªprojectçš„æ–‡ä»¶å¤¹ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªtxtæ–‡ä»¶å’Œä¸€ä¸ªexcelæ–‡ä»¶ï¼Œtxtæ˜¯æ•°æ®æ–‡ä»¶ï¼Œexcelæ˜¯å˜é‡åçš„å¯¹ç…§è¡¨ã€‚

    ```{r}
    newproject <- db_demo(years = 2015,Year = T,ageyr = "age",sex = "sex") |> 
      db_Alcohol.drinks() |> 
      dex_DII()
    # Factor(new)
    new$Year <- factor(new$Year, c('2015-2016'))
    new$sex <- factor(new$sex, c('Male', 'Female'))

    write.yier(df = x,file = "mydata")#å¯¼å‡ºæ•°æ®
    ```

## 10.æ–‡çŒ®å¤ç°

### 1. ä¸­æ€§ç²’ç»†èƒå‡å°‘çš„æµè¡Œç—…å­¦

Prevalence of Neutropenia in the U.S. Population: Age, Sex, Smoking, Status, and Ethnic Differences--[å‚è€ƒæ–‡çŒ®](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/0003-4819-146-7-200704030-00004.pdf)

å¹´ä»½ï¼š1999-2004ï¼Œé‡‡ç”¨çš„æƒé‡æ˜¯MECæƒé‡ï¼Œ1999-2002ï¼šwtmec4yrÃ—2/3ï¼›2003-2004ï¼šwtmec2yrÃ—1/3

#### æå–æ•°æ®

```{r}
library(nhanesR)
library(reshape2)
library(do)
d_demo <- db_demo(years = 1999:2004, ageyr = "age", sex = "sex", eth1 = "eth", 
                  wtmec4yr = T,wtmec2yr = T,Year = T)#æå–äººå£å­¦æ•°æ®
d_demo$nhs_wt <- ifelse(d_demo$Year %in% c("1999-2000","2001-2002"),
                        2/3*d_demo$wtmec4yr,1/3*d_demo$wtmec2yr)#è®¡ç®—åˆå¹¶æƒé‡
d_demo <- drop_col(d_demo,"wtmec4yr","wtmec2yr")#åˆ é™¤åŸæ¥çš„ä¸¤åˆ—æƒé‡

d_demo <- d_demo[d_demo$age>=1,]#ç ”ç©¶çš„æ˜¯1å²å³ä»¥ä¸Šçš„äººç¾¤ï¼Œè¿›è¡Œäº†è¿›ä¸€æ­¥çš„MECæ£€æŸ¥

d_cbc1 <- db_cbc(years = 1999:2004,wbc_1000cells.ul = "wbc",
                Segmented_neutrophils_number_1000cells.ul = "Neu",
                lymphocyte_number_1000cells.ul = "Lym",
                hemoglobin_g.dl = "Hb",
                Platelet_count_1000cells.uL = "Plt")#æå–å®éªŒå®¤æ£€æŸ¥è¡€æ¶²çš„æ•°æ®
nrow(d_demo)-nrow(d_cbc)#è¢«å‘ŠçŸ¥å»MECçš„æœ‰29608äººï¼Œå…¶ä¸­æ²¡æœ‰å»åšMECæ£€æŸ¥çš„æœ‰1668äºº

d_cbc <- complete.data(d_cbc1)#ğŸ˜Šç§»é™¤ç¼ºå¤±å€¼ï¼Œæ˜¾ç¤ºæœ‰2715ä¸ªNAã€‚æ–‡ä¸­æŠ¥å‘Šäº†3ä¸ªå¼‚å¸¸å€¼ï¼Œä½†å…¶å®åº”è¯¥æ²¡æœ‰
nrow(d_cbc) # 25225 complete cbc

d <- Inner_Join(d_demo,d_cbc)#åˆå¹¶äººå£å­¦æ•°æ®å’Œå®éªŒå®¤æ•°æ®
```

#### å¤æ‚æŠ½æ ·çš„åŠ æƒ

```{r}
nhs <- svy_design(data = d) #éœ€è¦å°†åˆå¹¶æƒé‡å˜é‡åè®¾ç½®ä¸ºnhs_wtï¼Œpsuå’Œstrataéƒ½æ˜¯æŒ‡å®šå¥½çš„
```

#### æ€»äººå£å’Œç¼ºå¤±äººç¾¤åˆ†æ

```{r}
svy_population(design = nhs)#ğŸ˜Šparticipantsä»£è¡¨çš„æ€»äººå£æ•°
#The 25 222 NHANES participants with valid hematologic indices represented 253.2 million noninstitutionalized residents of the United States

# Recode(d$eth)
d$eth <- Recode(d$eth,
	"Non-Hispanic White::white", 
	"Non-Hispanic Black::black", 
	"Other Race - Including Multi-Racial::others", 
	"Mexican American::Mexican", 
	"Other Hispanic::others",
	to.numeric = FALSE)

miss_seqn <- d_cbc1$seqn[!complete.cases(d_cbc1)]#ğŸ˜Šæå–å‡ºcbcé‡Œé¢ç¼ºå¤±äº†æ•°æ®çš„seqnåºå·
demo_miss <- d_demo[d_demo$seqn %in% miss_seqn,]#ä»d_demoæ•°æ®é‡Œæå–ç¼ºå¤±çš„seqnè¡Œ
freq_count(demo_miss,x = "eth")#ğŸ˜Šç§æ—çš„åˆ†å¸ƒ

bu_x <- demo_miss$age #å°†å¹´é¾„è¿›è¡Œåˆ†ç»„ç”Ÿæˆæ–°çš„åˆ—age_group
demo_miss$age_group[bu('( ,5 ]')] <- "<=5"   
demo_miss$age_group[bu('( 6, 17]')] <- "6-17"
demo_miss$age_group[bu('[ 18, )')] <- ">=18"
freq_count(demo_miss,x = "age_group")#ğŸ˜å¹´é¾„åˆ†å±‚çš„åˆ†å¸ƒ

#ç»Ÿè®¡äººç§çš„åˆ†å¸ƒå…¶å®æ˜¯çœ‹æ˜¯å¦æœ‰ç‰¹å®šçš„ç§æ—ç¼ºå¤±å¤ªå¤šï¼Œä¾‹å¦‚å¤§é‡çš„ç™½äººéƒ½ä¸æ¥æµ‹ï¼Œè¿™æ ·çš„è¯æ•°æ®çš„ä»£è¡¨æ€§å°±ä¼šå¾ˆå·®
```

#### çº¿æ€§å›å½’æ¯”è¾ƒä¸åŒç§æ—ç»†èƒè®¡æ•°çš„å˜åŒ–ï¼šæ ¡æ­£å¹´é¾„ã€æ€§åˆ«

ç›®å‰å¾—åˆ°äº†ä¸¤å¥—æ•°æ®ï¼Œä¸€å¥—æ˜¯åŸå§‹æ•°æ®dï¼Œä¸€å¥—æ˜¯åŠ æƒåçš„æ•°æ®nhsã€‚å¦‚æœè¦[**ä¿®æ”¹æˆ–è€…å¢åˆ æ•°æ®**]{.underline}ï¼Œéƒ½å…ˆåœ¨åŸå§‹æ•°æ®dä¸­ä¿®æ”¹ï¼Œä¹‹åå†è½¬æ¢ä¸ºåŠ æƒåçš„æ•°æ®nhsã€‚å¦‚æœè¦[**å–å­é›†ï¼ˆåˆ†å±‚ï¼‰**]{.underline}ï¼Œå°±ç›´æ¥åœ¨nhsåŠ æƒæ•°æ®ä¸Šæ“ä½œï¼ˆä½¿ç”¨subsetï¼‰ã€‚é‡‡ç”¨[å¹¿ä¹‰çº¿æ€§æ¨¡å‹](https://hyp.is/Q6TrtkSwEe2z2AtF2D6c9w/liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/R%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%AD%E6%96%87%E5%AE%8C%E6%95%B4%E7%89%88%EF%BC%89.pdf)æ¥è¿›è¡Œçº¿æ€§å›å½’

```{r}
library(survey)
d$eth <- factor(d$eth,levels = c("white", "black","Mexican", "others"))#unique(d$eth) |> dput() å¯ä»¥ç›´æ¥ç”Ÿæˆlevels
nhs <- svy_design(data = d)#ä¿®æ”¹å®Œä»¥åå†åŠ æƒ

svyglm(formula = wbc~eth + age +sex,design = nhs) |> summary()#ä½¿ç”¨surveyåŒ…çš„å¹¿ä¹‰çº¿æ€§æ¨¡å‹å›å½’
```

![çº¿æ€§å›å½’çš„ç»“æœ](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210052112168.png){width="358"}

æ ¹æ®ç»“æœå¯ä»¥å¾—å‡ºï¼Œç™½ç»†èƒè®°æ•°çš„å‡å€¼ï¼Œé»‘äººæ¯”ç™½äººä½0.86,å¢¨è¥¿å“¥äººæ¯”ç™½äººé«˜0.17

```{r}
#æ¯”è¾ƒä¸­æ€§ç²’ç»†èƒ,æ·‹å·´ç»†èƒåŒç†
svyglm(formula = Neu~eth + age +sex,design = nhs) |> summary()
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210052143543.png){width="358"}

#### Table1ï¼šMean Hematologic Values, by Age, Sex, and Ethnic Group

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210052210534.png){width="500"}

```{r}
bu_x <- d$age#å¯¹å¹´é¾„è¿›è¡Œåˆ†ç»„
d$age18[bu('[ ,18 )')] <- "<18"
d$age18[bu('[ 18, )')] <- ">=18"

nhs <- svy_design(data = d)

svy_mean(design = nhs,
         x = "wbc",
         by = c("sex","age18","eth"),ci = T) |> #ğŸ˜Šè®¡ç®—å‡å€¼å’Œç½®ä¿¡åŒºé—´ï¼Œè¿˜æœ‰å…¶ä»–å‚æ•°å¯ä»¥æŒ‡å®š
  dcast(formula = sex+age18~eth,value.var = "wbc_CI")
#è½¬åŒ–ä¸ºtable1çš„æ ¼å¼ï¼Œå·¦è¾¹æ˜¯æ€§åˆ«å¹´é¾„ï¼Œä¸Šé¢æ˜¯ç§æ—ï¼Œä¸­é—´çš„å€¼æ˜¯wbc_CI
#ç™½ç»†èƒå’Œæ·‹å·´ç»†èƒåŒç†
```

![](https://liulinhu-1313975787.cos.ap-chengdu.myqcloud.com/202210052248588.png)

## æ£€ç´¢è¡¨

```{r}
Left_Join(d1,d2,inspect = "")#åˆå¹¶ï¼ŒæŸ¥çœ‹å˜é‡åˆå¹¶å‰åå˜åŒ–
db_demo()#äººå£å­¦æ•°æ®
db_cbc()#å…¨è¡€ç»†èƒç±»å‹çš„æ•°æ®
dex_phenoAge()#ç”Ÿç‰©å­¦å¹´é¾„
add_col()#æ·»åŠ åˆ—
select_row()#ä¿ç•™æŸäº›è¡Œ,%in%, ==, !==, >=
dro_row(is.na())#å»é™¤æŸäº›è¡Œï¼Œå¦‚NAç­‰
db_slq()#ç¡çœ éšœç¢ç›¸å…³æ•°æ®
db_PbCd()#é‡é‡‘å±ç›¸å…³æ•°æ®
db_Alcohol.drinks()#æå–é…’ç²¾ä½¿ç”¨drinks/dayçš„æ•°æ®
db_drtot(alcohol_g = )#æå–é…’ç²¾ä½¿ç”¨g/day
diag_alcohol.user()#é…’ç²¾ä½¿ç”¨ç¨‹åº¦
```
